<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Painel de Controle - Dashboards</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
  :root{
    --bg:#0f0f23;
    --bg2:#1a1a2e;
    --panel:#16213e;
    --stroke:rgba(148,163,184,.25);
    --muted:rgba(148,163,184,.8);
    --grad:linear-gradient(135deg,#ff6b35,#8b5cf6);
    --accent:#00ff88;
    --danger:#ff4757;
    --warning:#ffa726;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;
       background:linear-gradient(135deg,var(--bg) 0%,var(--bg2) 50%,var(--panel) 100%);
       min-height:100vh;}
  .container{max-width:1400px;margin:0 auto;padding:32px 32px 40px}
  .header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:20px;margin-bottom:40px}
  .logo{display:flex;align-items:center;gap:12px}
  .logo-icon{width:48px;height:48px;border-radius:12px;background:var(--grad);display:grid;place-items:center;font-weight:700;font-size:1.2rem}
  .header-content h1{font-size:2.5rem;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .header-content p{color:var(--muted);font-size:1.1rem;margin-top:8px}
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:40px}
  .stat-card{background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:16px;padding:24px;backdrop-filter:blur(8px);text-align:center}
  .stat-number{font-size:2.5rem;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .stat-label{color:var(--muted);font-size:.9rem;text-transform:uppercase;letter-spacing:.1em;margin-top:8px}
  .dashboards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:24px}
  .dashboard-card{background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:16px;overflow:hidden;transition:all .3s ease;backdrop-filter:blur(8px)}
  .dashboard-card:hover{transform:translateY(-4px);border-color:rgba(255,107,53,.5);box-shadow:0 12px 32px rgba(139,92,246,.2)}
  .card-thumbnail{height:200px;background:linear-gradient(135deg,rgba(255,107,53,.1),rgba(139,92,246,.1));display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .card-thumbnail::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>') repeat;opacity:0.3}
  .thumbnail-content{display:flex;flex-direction:column;align-items:center;gap:12px;z-index:1}
  .thumbnail-icon{font-size:3rem;opacity:0.8}
  .thumbnail-charts{display:flex;gap:8px;align-items:end}
  .chart-bar{width:8px;background:var(--grad);border-radius:2px;opacity:0.7}
  .chart-bar:nth-child(1){height:20px}
  .chart-bar:nth-child(2){height:35px}
  .chart-bar:nth-child(3){height:25px}
  .chart-bar:nth-child(4){height:40px}
  .chart-bar:nth-child(5){height:30px}
  .card-content{padding:24px}
  .card-title{font-size:1.25rem;font-weight:700;margin-bottom:8px;color:#fff}
  .card-description{color:var(--muted);font-size:.9rem;line-height:1.5;margin-bottom:20px}
  .card-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;font-size:.85rem}
  .card-status{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-weight:600;font-size:.8rem}
  .status-active{background:rgba(0,255,136,.2);border:1px solid rgba(0,255,136,.4);color:var(--accent)}
  .card-actions{display:flex;gap:12px;width:100%}
  .card-link{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:var(--grad);color:#fff;text-decoration:none;border-radius:10px;font-weight:600;transition:all .3s ease;flex:1;justify-content:center}
  .card-link:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(139,92,246,.4)}
  .sync-button{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;background:linear-gradient(135deg,rgba(0,255,136,.2),rgba(0,255,136,.4));border:1px solid rgba(0,255,136,.5);color:var(--accent);text-decoration:none;border-radius:10px;font-weight:600;transition:all .3s ease;cursor:pointer;min-width:120px;justify-content:center}
  .sync-button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,255,136,.3);background:linear-gradient(135deg,rgba(0,255,136,.3),rgba(0,255,136,.5))}
  .sync-button:disabled{opacity:0.6;cursor:not-allowed;transform:none}
  .sync-button.syncing{animation:pulse 1.5s infinite}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
  .loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--muted)}
  .spinner{border:2px solid rgba(148,163,184,.2);border-top:2px solid var(--accent);border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite;margin-right:12px}
  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  .empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
  .empty-state h3{font-size:1.5rem;margin-bottom:12px;color:#fff}
  .empty-state p{font-size:1rem;line-height:1.6}
  /* Modal Styles */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}
  .modal.active{display:flex}
  .modal-content{background:var(--panel);border:1px solid var(--stroke);border-radius:20px;width:90%;max-width:800px;max-height:90vh;overflow-y:auto;position:relative}
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:24px 32px;border-bottom:1px solid var(--stroke)}
  .modal-title{font-size:1.5rem;font-weight:700;color:#fff}
  .modal-close{background:none;border:none;color:var(--muted);font-size:1.5rem;cursor:pointer;padding:8px;border-radius:8px;transition:all .3s ease}
  .modal-close:hover{background:rgba(255,255,255,.1);color:#fff}
  .modal-body{padding:32px}
  .form-group{margin-bottom:24px}
  .form-label{display:block;margin-bottom:8px;font-weight:600;color:#fff;font-size:.9rem}
  .form-input,.form-select,.form-textarea{width:100%;padding:12px 16px;background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:10px;color:#fff;font-size:.9rem;transition:all .3s ease}
  .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,255,136,.1)}
  .form-textarea{min-height:100px;resize:vertical}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}
  .channels-section{margin-top:32px;padding-top:24px;border-top:1px solid var(--stroke)}
  .channels-title{font-size:1.2rem;font-weight:700;color:#fff;margin-bottom:20px}
  .channel-item{display:flex;align-items:center;gap:12px;padding:16px;background:rgba(26,26,46,.5);border:1px solid var(--stroke);border-radius:12px;margin-bottom:12px}
  .channel-checkbox{width:20px;height:20px;accent-color:var(--accent)}
  .channel-label{flex:1;color:#fff;font-weight:500}
  .channel-config{flex:2;display:flex;gap:12px;align-items:center}
  .channel-sheet-input{flex:1;padding:8px 12px;background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:8px;color:#fff;font-size:.85rem}
  .channel-sheet-input:focus{outline:none;border-color:var(--accent)}
  .modal-footer{display:flex;gap:12px;justify-content:flex-end;padding:24px 32px;border-top:1px solid var(--stroke)}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:all .3s ease;text-decoration:none}
  .btn-primary{background:var(--grad);color:#fff}
  .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(139,92,246,.4)}
  .btn-secondary{background:rgba(148,163,184,.2);border:1px solid rgba(148,163,184,.4);color:var(--muted)}
  .btn-secondary:hover{background:rgba(148,163,184,.3);color:#fff}
  .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
  .loading-spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid #fff;border-radius:50%;animation:spin 1s linear infinite}
  .preview-section{margin-top:24px;padding:20px;background:rgba(26,26,46,.3);border:1px solid var(--stroke);border-radius:12px}
  .preview-title{font-size:1rem;font-weight:600;color:#fff;margin-bottom:12px}
  .preview-content{color:var(--muted);font-size:.9rem;line-height:1.5}
  @media (max-width:768px){
    .container{padding:20px 16px}
    .header-content h1{font-size:2rem}
    .dashboards-grid{grid-template-columns:1fr}
    .stats{grid-template-columns:repeat(2,1fr)}
    .modal-content{width:95%;margin:20px}
    .form-row,.form-row-3{grid-template-columns:1fr}
    .channel-config{flex-direction:column;align-items:stretch}
    .modal-footer{flex-direction:column}
  }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
    <div class="logo">
      <div class="logo-icon">📊</div>
    </div>
    <div class="header-content">
      <h1>Painel de Controle</h1>
      <p>Central de gerenciamento de dashboards analíticos</p>
    </div>
    <div style="display:flex;gap:12px;align-items:center;">
      <button onclick="openCreateDashboardModal()" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,rgba(0,255,136,.2),rgba(0,255,136,.4));border:1px solid rgba(0,255,136,.5);border-radius:10px;color:var(--accent);text-decoration:none;font-weight:600;transition:all .3s ease;cursor:pointer;">
        <span>➕</span>
        <span>Criar Dashboard</span>
      </button>
      <a href="/login.html" style="display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,rgba(255,107,53,.2),rgba(255,107,53,.4));border:1px solid rgba(255,107,53,.5);border-radius:10px;color:#ff6b35;text-decoration:none;font-weight:600;transition:all .3s ease;">
        <span>🔐</span>
        <span>Área Restrita</span>
      </a>
    </div>
  </div>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-number" id="totalDashboards">0</div>
      <div class="stat-label">Dashboards</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="activeDashboards">0</div>
      <div class="stat-label">Ativos</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="lastUpdate">-</div>
      <div class="stat-label">Última Atualização</div>
    </div>
  </div>

  <div id="loadingState" class="loading">
    <div class="spinner"></div>
    Carregando dashboards...
  </div>

  <div id="dashboardsContainer" class="dashboards-grid" style="display:none">
    <!-- Dashboards serão carregados aqui -->
        </div>

  <div id="emptyState" class="empty-state" style="display:none">
    <h3>Nenhum dashboard encontrado</h3>
    <p>Verifique se os arquivos estão na pasta /static</p>
  </div>
        </div>

<!-- Modal de Criação de Dashboard -->
<div id="createDashboardModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">➕ Criar Novo Dashboard</h2>
      <button class="modal-close" onclick="closeCreateDashboardModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <form id="createDashboardForm">
        <!-- Informações Básicas -->
        <div class="form-group">
          <label class="form-label" for="campaignName">Nome da Campanha *</label>
          <input type="text" id="campaignName" class="form-input" placeholder="Ex: Campanha Black Friday 2025" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="startDate">Data de Início *</label>
            <input type="date" id="startDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="endDate">Data de Fim *</label>
            <input type="date" id="endDate" class="form-input" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="totalBudget">Verba Total Líquida (R$) *</label>
            <input type="number" id="totalBudget" class="form-input" placeholder="50000" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="reportModel">Modelo de Relatório *</label>
            <select id="reportModel" class="form-select" required>
              <option value="">Selecione o modelo</option>
              <option value="simple">Simples - Métricas básicas</option>
              <option value="multichannel">Multicanal - Análise completa</option>
            </select>
          </div>
        </div>

        <!-- Configuração de KPI -->
        <div class="form-row-3">
          <div class="form-group">
            <label class="form-label" for="kpiType">KPI Negociado *</label>
            <select id="kpiType" class="form-select" required>
              <option value="">Selecione o KPI</option>
              <option value="cpm">CPM (Custo por Mil Impressões)</option>
              <option value="cpv">CPV (Custo por Visualização)</option>
              <option value="cpc">CPC (Custo por Clique)</option>
              <option value="lead">Lead (Custo por Lead)</option>
              <option value="conversion">Conversão (Custo por Conversão)</option>
              <option value="reach">Alcance (Custo por Alcance)</option>
              <option value="engagement">Engajamento (Custo por Engajamento)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="kpiValue">Valor Unitário do KPI (R$) *</label>
            <input type="number" id="kpiValue" class="form-input" placeholder="2.50" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="kpiTarget">Meta do KPI *</label>
            <input type="number" id="kpiTarget" class="form-input" placeholder="10000" min="0" required>
          </div>
        </div>

        <!-- Estratégias da Campanha -->
        <div class="form-group">
          <label class="form-label" for="campaignStrategies">Estratégias da Campanha *</label>
          <textarea id="campaignStrategies" class="form-textarea" placeholder="Descreva as estratégias que serão utilizadas na campanha, objetivos, público-alvo, abordagem criativa, etc." required></textarea>
        </div>

        <!-- Seleção de Canais -->
        <div class="channels-section">
          <h3 class="channels-title">📺 Canais de Mídia</h3>
          <p style="color: var(--muted); margin-bottom: 20px; font-size: 0.9rem;">Selecione os canais que serão utilizados e configure as planilhas do Google Sheets para cada um:</p>
          
          <div class="channel-item">
            <input type="checkbox" id="channel_youtube" class="channel-checkbox" value="youtube">
            <label for="channel_youtube" class="channel-label">📺 YouTube</label>
            <div class="channel-config">
              <input type="text" id="youtube_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="youtube_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_tiktok" class="channel-checkbox" value="tiktok">
            <label for="channel_tiktok" class="channel-label">🎵 TikTok</label>
            <div class="channel-config">
              <input type="text" id="tiktok_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="tiktok_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_netflix" class="channel-checkbox" value="netflix">
            <label for="channel_netflix" class="channel-label">🎬 Netflix</label>
            <div class="channel-config">
              <input type="text" id="netflix_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="netflix_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_disney" class="channel-checkbox" value="disney">
            <label for="channel_disney" class="channel-label">🏰 Disney+</label>
            <div class="channel-config">
              <input type="text" id="disney_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="disney_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_ctv" class="channel-checkbox" value="ctv">
            <label for="channel_ctv" class="channel-label">📺 CTV (Connected TV)</label>
            <div class="channel-config">
              <input type="text" id="ctv_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="ctv_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_programmatic" class="channel-checkbox" value="programmatic">
            <label for="channel_programmatic" class="channel-label">🎯 Programática</label>
            <div class="channel-config">
              <input type="text" id="programmatic_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="programmatic_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_footfall_display" class="channel-checkbox" value="footfall_display">
            <label for="channel_footfall_display" class="channel-label">📍 Footfall Display</label>
            <div class="channel-config">
              <input type="text" id="footfall_display_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="footfall_display_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>

          <div class="channel-item">
            <input type="checkbox" id="channel_footfall_map" class="channel-checkbox" value="footfall_map">
            <label for="channel_footfall_map" class="channel-label">🗺️ Footfall Mapa</label>
            <div class="channel-config">
              <input type="text" id="footfall_map_sheet" class="channel-sheet-input" placeholder="ID da planilha Google Sheets" disabled>
              <input type="text" id="footfall_map_gid" class="channel-sheet-input" placeholder="GID da aba (opcional)" disabled>
            </div>
          </div>
        </div>

        <!-- Preview da Configuração -->
        <div class="preview-section">
          <h4 class="preview-title">👁️ Preview da Configuração</h4>
          <div id="previewContent" class="preview-content">
            Preencha os campos acima para ver o preview da configuração...
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeCreateDashboardModal()">Cancelar</button>
      <button type="button" class="btn btn-primary" onclick="saveDashboard()" id="saveDashboardBtn">
        <span>💾</span>
        <span>Salvar Dashboard</span>
      </button>
    </div>
  </div>
</div>

<script>
// Lista de dashboards disponíveis
const dashboards = [
  {
    file: 'dash_sonho.html',
    name: 'Dashboard Sonho',
    description: 'Dashboard multicanal com análise de vídeo + display e footfall das lojas Recibom',
    status: 'active',
    category: 'Multicanal',
    lastUpdate: 'Hoje',
    icon: '🎯'
  },
  {
    file: 'dash_copacol.html',
    name: 'Dashboard Copacol',
    description: 'Dashboard de performance para campanhas Copacol',
    status: 'active',
    category: 'Retail',
    lastUpdate: 'Ontem',
    icon: '🛒'
  },
  {
    file: 'dash_copacol_mestre_das_grelhas.html',
    name: 'Copacol - Mestre das Grelhas',
    description: 'Dashboard especializado para campanha Mestre das Grelhas',
    status: 'active',
    category: 'Retail',
    lastUpdate: 'Ontem',
    icon: '🔥'
  },
  {
    file: 'dash_dauher_hidrabene.html',
    name: 'Dashboard Dauher Hidrabene',
    description: 'Análise de performance para campanhas Dauher Hidrabene',
    status: 'active',
    category: 'Saúde',
    lastUpdate: '2 dias',
    icon: '💊'
  },
  {
    file: 'dash_sebrae.html',
    name: 'Dashboard Sebrae',
    description: 'Dashboard de métricas e KPIs para campanhas Sebrae',
    status: 'active',
    category: 'Educacional',
    lastUpdate: '3 dias',
    icon: '🎓'
  },
  {
    file: 'dash_unicesusc.html',
    name: 'Dashboard Unicesusc',
    description: 'Análise de performance para campanhas Unicesusc',
    status: 'active',
    category: 'Educacional',
    lastUpdate: '1 semana',
    icon: '🏫'
  },
  {
    file: 'dash_unimed.html',
    name: 'Dashboard Unimed',
    description: 'Dashboard de métricas para campanhas Unimed',
    status: 'active',
    category: 'Saúde',
    lastUpdate: '1 semana',
    icon: '🏥'
  }
];

// Função para criar card de dashboard
function createDashboardCard(dashboard) {
  const statusClass = dashboard.status === 'active' ? 'status-active' : '';
  const statusText = dashboard.status === 'active' ? '🟢 Ativo' : '🔴 Inativo';
  
  // Verificar se é o Dashboard Sonho para adicionar botão de sync
  const isSonhoDashboard = dashboard.file === 'dash_sonho.html';
  
  // Verificar se é dashboard dinâmico
  const isDynamicDashboard = dashboard.isDynamic;
  
  let actionsHtml = '';
  
  if (isSonhoDashboard) {
    actionsHtml = `
      <div class="card-actions">
        <a href="/static/${dashboard.file}" class="card-link" target="_blank">
          <span>📊</span>
          <span>Acessar</span>
        </a>
        <button class="sync-button" onclick="syncDashboard('${dashboard.file}')" id="sync-${dashboard.file}">
          <span>🔄</span>
          <span>Sync</span>
        </button>
      </div>
    `;
  } else if (isDynamicDashboard) {
    // Dashboard dinâmico - botões específicos baseados no status
    if (dashboard.status === 'created') {
      actionsHtml = `
        <div class="card-actions">
          <a href="${dashboard.url}" class="card-link" target="_blank">
            <span>👁️</span>
            <span>Visualizar</span>
          </a>
          <button class="sync-button" onclick="validateDashboard('${dashboard.id}')" id="validate-${dashboard.id}">
            <span>✅</span>
            <span>Validar</span>
          </button>
        </div>
      `;
    } else if (dashboard.status === 'validated') {
      actionsHtml = `
        <div class="card-actions">
          <a href="${dashboard.url}" class="card-link" target="_blank">
            <span>📊</span>
            <span>Acessar</span>
          </a>
          <button class="sync-button" onclick="activateDashboard('${dashboard.id}')" id="activate-${dashboard.id}">
            <span>🚀</span>
            <span>Ativar</span>
          </button>
        </div>
      `;
    } else {
      actionsHtml = `
        <div class="card-actions">
          <a href="${dashboard.url}" class="card-link" target="_blank">
            <span>📊</span>
            <span>Acessar</span>
          </a>
          <button class="sync-button" onclick="syncDynamicDashboard('${dashboard.id}')" id="sync-${dashboard.id}">
            <span>🔄</span>
            <span>Sync</span>
          </button>
        </div>
      `;
    }
  } else {
    // Dashboard estático normal
    actionsHtml = `
      <a href="/static/${dashboard.file}" class="card-link" target="_blank">
        <span>📊</span>
        <span>Acessar Dashboard</span>
      </a>
    `;
  }
  
  return `
    <div class="dashboard-card" data-dashboard-file="${dashboard.file}" style="cursor: pointer;">
      <div class="card-thumbnail">
        <div class="thumbnail-content">
          <div class="thumbnail-icon">${dashboard.icon}</div>
          <div class="thumbnail-charts">
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
            <div class="chart-bar"></div>
          </div>
        </div>
      </div>
      <div class="card-content">
        <h3 class="card-title">${dashboard.name}</h3>
        <p class="card-description">${dashboard.description}</p>
        <div class="card-meta">
          <span class="card-status ${statusClass}">${statusText}</span>
          <span style="color: var(--muted);">${dashboard.category}</span>
        </div>
        ${actionsHtml}
        </div>
    </div>
  `;
}

// Função para abrir dashboard
function openDashboard(fileName) {
  if (fileName) {
    window.open(`/static/${fileName}`, '_blank');
  }
}

// Função para carregar dashboards
function loadDashboards() {
  const container = document.getElementById('dashboardsContainer');
  const loadingState = document.getElementById('loadingState');
  const emptyState = document.getElementById('emptyState');
  
  // Usar apenas dashboards estáticos - sem fetch, sem async
  loadingState.style.display = 'none';
  
  if (dashboards.length === 0) {
    emptyState.style.display = 'block';
  } else {
    container.style.display = 'grid';
    container.innerHTML = dashboards.map(createDashboardCard).join('');
    
    // Atualizar estatísticas
    document.getElementById('totalDashboards').textContent = dashboards.length;
    document.getElementById('activeDashboards').textContent = 
      dashboards.filter(d => d.status === 'active').length;
    document.getElementById('lastUpdate').textContent = 'Agora';
  }
}

// Inicializar quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
  loadDashboards();
  initializeDashboardBuilder();
});

// Event delegation para cliques nos cards de dashboard
document.addEventListener('click', (e) => {
  const dashboardCard = e.target.closest('.dashboard-card');
  if (dashboardCard) {
    const fileName = dashboardCard.getAttribute('data-dashboard-file');
    if (fileName) {
      openDashboard(fileName);
    }
  }
});

// ===== DASHBOARD BUILDER FUNCTIONS =====

function initializeDashboardBuilder() {
  // Adicionar event listeners para os checkboxes dos canais
  const channelCheckboxes = document.querySelectorAll('.channel-checkbox');
  channelCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const channelName = this.value;
      const sheetInput = document.getElementById(`${channelName}_sheet`);
      const gidInput = document.getElementById(`${channelName}_gid`);
      
      if (this.checked) {
        sheetInput.disabled = false;
        gidInput.disabled = false;
        sheetInput.required = true;
      } else {
        sheetInput.disabled = true;
        gidInput.disabled = true;
        sheetInput.required = false;
        sheetInput.value = '';
        gidInput.value = '';
      }
      
      updatePreview();
    });
  });
  
  // Adicionar event listeners para atualizar preview em tempo real
  const formInputs = document.querySelectorAll('#createDashboardForm input, #createDashboardForm select, #createDashboardForm textarea');
  formInputs.forEach(input => {
    input.addEventListener('input', updatePreview);
    input.addEventListener('change', updatePreview);
  });
}

function openCreateDashboardModal() {
  const modal = document.getElementById('createDashboardModal');
  modal.classList.add('active');
  
  // Definir data mínima como hoje
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('startDate').min = today;
  document.getElementById('endDate').min = today;
  
  // Limpar formulário
  document.getElementById('createDashboardForm').reset();
  
  // Desabilitar todos os inputs de planilhas
  const sheetInputs = document.querySelectorAll('.channel-sheet-input');
  sheetInputs.forEach(input => {
    input.disabled = true;
    input.required = false;
  });
  
  updatePreview();
}

function closeCreateDashboardModal() {
  const modal = document.getElementById('createDashboardModal');
  modal.classList.remove('active');
}

function updatePreview() {
  const previewContent = document.getElementById('previewContent');
  
  const campaignName = document.getElementById('campaignName').value;
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  const totalBudget = document.getElementById('totalBudget').value;
  const reportModel = document.getElementById('reportModel').value;
  const kpiType = document.getElementById('kpiType').value;
  const kpiValue = document.getElementById('kpiValue').value;
  const kpiTarget = document.getElementById('kpiTarget').value;
  const strategies = document.getElementById('campaignStrategies').value;
  
  // Contar canais selecionados
  const selectedChannels = [];
  const channelCheckboxes = document.querySelectorAll('.channel-checkbox:checked');
  channelCheckboxes.forEach(checkbox => {
    const channelName = checkbox.value;
    const sheetId = document.getElementById(`${channelName}_sheet`).value;
    if (sheetId) {
      selectedChannels.push({
        name: checkbox.nextElementSibling.textContent,
        sheetId: sheetId
      });
    }
  });
  
  let previewHTML = '';
  
  if (campaignName) {
    previewHTML += `<strong>📋 Campanha:</strong> ${campaignName}<br>`;
  }
  
  if (startDate && endDate) {
    const start = new Date(startDate).toLocaleDateString('pt-BR');
    const end = new Date(endDate).toLocaleDateString('pt-BR');
    previewHTML += `<strong>📅 Período:</strong> ${start} a ${end}<br>`;
  }
  
  if (totalBudget) {
    previewHTML += `<strong>💰 Orçamento:</strong> R$ ${parseFloat(totalBudget).toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>`;
  }
  
  if (reportModel) {
    const modelName = reportModel === 'simple' ? 'Simples' : 'Multicanal';
    previewHTML += `<strong>📊 Modelo:</strong> ${modelName}<br>`;
  }
  
  if (kpiType && kpiValue && kpiTarget) {
    const kpiNames = {
      'cpm': 'CPM',
      'cpv': 'CPV', 
      'cpc': 'CPC',
      'lead': 'Lead',
      'conversion': 'Conversão',
      'reach': 'Alcance',
      'engagement': 'Engajamento'
    };
    previewHTML += `<strong>🎯 KPI:</strong> ${kpiNames[kpiType]} - R$ ${parseFloat(kpiValue).toFixed(2)} (Meta: ${parseInt(kpiTarget).toLocaleString()})<br>`;
  }
  
  if (selectedChannels.length > 0) {
    previewHTML += `<strong>📺 Canais (${selectedChannels.length}):</strong> `;
    previewHTML += selectedChannels.map(ch => ch.name).join(', ') + '<br>';
  }
  
  if (strategies) {
    const shortStrategies = strategies.length > 100 ? strategies.substring(0, 100) + '...' : strategies;
    previewHTML += `<strong>💡 Estratégias:</strong> ${shortStrategies}<br>`;
  }
  
  if (!previewHTML) {
    previewHTML = 'Preencha os campos acima para ver o preview da configuração...';
  }
  
  previewContent.innerHTML = previewHTML;
}

function validateForm() {
  const form = document.getElementById('createDashboardForm');
  const requiredFields = form.querySelectorAll('[required]');
  let isValid = true;
  
  // Verificar campos obrigatórios
  requiredFields.forEach(field => {
    if (!field.value.trim()) {
      field.style.borderColor = '#ff4757';
      isValid = false;
    } else {
      field.style.borderColor = '';
    }
  });
  
  // Verificar se pelo menos um canal foi selecionado
  const selectedChannels = document.querySelectorAll('.channel-checkbox:checked');
  if (selectedChannels.length === 0) {
    alert('⚠️ Selecione pelo menos um canal de mídia!');
    isValid = false;
  }
  
  // Verificar se todos os canais selecionados têm planilha configurada
  selectedChannels.forEach(checkbox => {
    const channelName = checkbox.value;
    const sheetInput = document.getElementById(`${channelName}_sheet`);
    if (!sheetInput.value.trim()) {
      alert(`⚠️ Configure a planilha do Google Sheets para o canal ${checkbox.nextElementSibling.textContent}!`);
      sheetInput.style.borderColor = '#ff4757';
      isValid = false;
    } else {
      sheetInput.style.borderColor = '';
    }
  });
  
  // Verificar datas
  const startDate = new Date(document.getElementById('startDate').value);
  const endDate = new Date(document.getElementById('endDate').value);
  if (endDate <= startDate) {
    alert('⚠️ A data de fim deve ser posterior à data de início!');
    isValid = false;
  }
  
  return isValid;
}

async function saveDashboard() {
  if (!validateForm()) {
    return;
  }
  
  const saveBtn = document.getElementById('saveDashboardBtn');
  const originalText = saveBtn.innerHTML;
  
  // Mostrar loading
  saveBtn.disabled = true;
  saveBtn.innerHTML = '<span class="loading-spinner"></span><span>Salvando...</span>';
  
  try {
    // Coletar dados do formulário
    const formData = {
      campaignName: document.getElementById('campaignName').value,
      startDate: document.getElementById('startDate').value,
      endDate: document.getElementById('endDate').value,
      totalBudget: parseFloat(document.getElementById('totalBudget').value),
      reportModel: document.getElementById('reportModel').value,
      kpiType: document.getElementById('kpiType').value,
      kpiValue: parseFloat(document.getElementById('kpiValue').value),
      kpiTarget: parseInt(document.getElementById('kpiTarget').value),
      strategies: document.getElementById('campaignStrategies').value,
      channels: []
    };
    
    // Coletar canais selecionados
    const channelCheckboxes = document.querySelectorAll('.channel-checkbox:checked');
    channelCheckboxes.forEach(checkbox => {
      const channelName = checkbox.value;
      const sheetId = document.getElementById(`${channelName}_sheet`).value;
      const gid = document.getElementById(`${channelName}_gid`).value;
      
      formData.channels.push({
        name: channelName,
        displayName: checkbox.nextElementSibling.textContent,
        sheetId: sheetId,
        gid: gid || null
      });
    });
    
    console.log('📊 Dados do dashboard:', formData);
    
    // API local não disponível - funcionalidade desabilitada temporariamente
    console.log('📊 Dados do dashboard preparados:', formData);
    alert('Dashboard builder em desenvolvimento. Dados preparados com sucesso!');
    document.getElementById('createDashboardBtn').disabled = false;
    document.getElementById('createDashboardBtn').innerHTML = '<span>📊</span><span>Criar Dashboard</span>';
    return;
    
    const result = await response.json();
    
    if (!response.ok) {
      throw new Error(result.message || 'Erro ao criar dashboard');
    }
    
    if (!result.success) {
      throw new Error(result.message || 'Falha na criação do dashboard');
    }
    
    // Sucesso
    saveBtn.innerHTML = '<span>✅</span><span>Salvo!</span>';
    
    setTimeout(() => {
      closeCreateDashboardModal();
      alert(`🎉 Dashboard criado com sucesso!\n\nID: ${result.dashboard.id}\nArquivo: ${result.dashboard.fileName}\n\nPróximos passos:\n1. Validar o dashboard gerado\n2. Configurar agendamento automático\n3. Iniciar coleta de dados`);
      
      // Recarregar lista de dashboards
      loadDashboards();
    }, 1000);
    
  } catch (error) {
    console.error('❌ Erro ao salvar dashboard:', error);
    alert('❌ Erro ao salvar dashboard. Tente novamente.');
    
    // Restaurar botão
    saveBtn.disabled = false;
    saveBtn.innerHTML = originalText;
  }
}

// ===== FUNÇÕES PARA DASHBOARDS DINÂMICOS =====

async function validateDashboard(dashboardId) {
  const buttonId = `validate-${dashboardId}`;
  const button = document.getElementById(buttonId);
  
  if (!button) {
    console.error('Botão de validação não encontrado');
    return;
  }
  
  // Desabilitar botão e mostrar loading
  button.disabled = true;
  button.innerHTML = '<span class="loading-spinner"></span><span>Validando...</span>';
  
  try {
    console.log(`✅ Validando dashboard ${dashboardId}...`);
    
    // API local não disponível - validação desabilitada temporariamente
    console.log(`✅ Validação simulada para dashboard ${dashboardId}`);
    button.disabled = false;
    button.innerHTML = '<span>✅</span><span>Validar</span>';
    alert('Validação simulada com sucesso!');
    return;
    
    const result = await response.json();
    
    if (!response.ok) {
      throw new Error(result.message || 'Erro ao validar dashboard');
    }
    
    if (!result.success) {
      throw new Error(result.message || 'Falha na validação do dashboard');
    }
    
    // Sucesso
    button.innerHTML = '<span>✅</span><span>Validado!</span>';
    button.style.background = 'linear-gradient(135deg,rgba(0,255,136,.3),rgba(0,255,136,.5))';
    
    // Recarregar lista de dashboards desabilitado (API não disponível)
    console.log('Recarga de dashboards desabilitada');
    
  } catch (error) {
    console.error('❌ Erro na validação:', error);
    
    // Erro
    button.innerHTML = '<span>❌</span><span>Erro</span>';
    button.style.background = 'linear-gradient(135deg,rgba(255,71,87,.3),rgba(255,71,87,.5))';
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.innerHTML = '<span>✅</span><span>Validar</span>';
      button.style.background = '';
    }, 3000);
  }
}

async function activateDashboard(dashboardId) {
  const buttonId = `activate-${dashboardId}`;
  const button = document.getElementById(buttonId);
  
  if (!button) {
    console.error('Botão de ativação não encontrado');
    return;
  }
  
  // Desabilitar botão e mostrar loading
  button.disabled = true;
  button.innerHTML = '<span class="loading-spinner"></span><span>Ativando...</span>';
  
  try {
    console.log(`🚀 Ativando dashboard ${dashboardId}...`);
    
    // Por enquanto, simular ativação
    // Em uma implementação completa, aqui seria feita a chamada para ativar o agendamento
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    // Sucesso
    button.innerHTML = '<span>🚀</span><span>Ativado!</span>';
    button.style.background = 'linear-gradient(135deg,rgba(0,255,136,.3),rgba(0,255,136,.5))';
    
    alert('🎉 Dashboard ativado com sucesso!\n\nO agendamento automático foi configurado e a coleta de dados será iniciada.');
    
    // Recarregar lista de dashboards desabilitado (API não disponível)
    console.log('Recarga de dashboards desabilitada');
    
  } catch (error) {
    console.error('❌ Erro na ativação:', error);
    
    // Erro
    button.innerHTML = '<span>❌</span><span>Erro</span>';
    button.style.background = 'linear-gradient(135deg,rgba(255,71,87,.3),rgba(255,71,87,.5))';
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.innerHTML = '<span>🚀</span><span>Ativar</span>';
      button.style.background = '';
    }, 3000);
  }
}

async function syncDynamicDashboard(dashboardId) {
  const buttonId = `sync-${dashboardId}`;
  const button = document.getElementById(buttonId);
  
  if (!button) {
    console.error('Botão de sync não encontrado');
    return;
  }
  
  // Desabilitar botão e mostrar loading
  button.disabled = true;
  button.innerHTML = '<span class="loading-spinner"></span><span>Sincronizando...</span>';
  
  try {
    console.log(`🔄 Sincronizando dashboard dinâmico ${dashboardId}...`);
    
    // Por enquanto, simular sincronização
    // Em uma implementação completa, aqui seria feita a chamada para sincronizar dados
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    // Sucesso
    button.innerHTML = '<span>✅</span><span>Concluído!</span>';
    button.style.background = 'linear-gradient(135deg,rgba(0,255,136,.3),rgba(0,255,136,.5))';
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.innerHTML = '<span>🔄</span><span>Sync</span>';
      button.style.background = '';
    }, 3000);
    
  } catch (error) {
    console.error('❌ Erro na sincronização:', error);
    
    // Erro
    button.innerHTML = '<span>❌</span><span>Erro</span>';
    button.style.background = 'linear-gradient(135deg,rgba(255,71,87,.3),rgba(255,71,87,.5))';
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.innerHTML = '<span>🔄</span><span>Sync</span>';
      button.style.background = '';
    }, 3000);
  }
}

// Função para verificar se dashboard existe (opcional)
async function checkDashboardExists(file) {
  try {
    const response = await fetch(`/static/${file}`, { method: 'HEAD' });
    return response.ok;
  } catch {
    return false;
  }
}

// Função para sincronizar dashboard via Cloud Run
async function syncDashboard(file) {
  const buttonId = `sync-${file}`;
  const button = document.getElementById(buttonId);
  
  if (!button) {
    console.error('Botão de sync não encontrado');
    return;
  }
  
  // Desabilitar botão e mostrar estado de loading
  button.disabled = true;
  button.classList.add('syncing');
  button.innerHTML = '<span>⏳</span><span>Sincronizando...</span>';
  
  try {
    console.log(`🔄 Iniciando sincronização do ${file}...`);
    
    // Fazer chamada para o Cloud Run dashboard-automation
    const response = await fetch('https://dashboard-automation-609095880025.us-central1.run.app/trigger', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // Nota: Em produção, você precisaria de autenticação adequada
        // 'Authorization': 'Bearer YOUR_TOKEN'
      },
      body: JSON.stringify({
        test_mode: false
      })
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const result = await response.json();
    console.log('✅ Sincronização concluída:', result);
    
    // Sucesso
    button.innerHTML = '<span>✅</span><span>Concluído!</span>';
    button.style.background = 'linear-gradient(135deg,rgba(0,255,136,.3),rgba(0,255,136,.5))';
    
    // Atualizar timestamp
    updateLastSyncTime();
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.classList.remove('syncing');
      button.innerHTML = '<span>🔄</span><span>Sync</span>';
      button.style.background = '';
    }, 3000);
    
  } catch (error) {
    console.error('❌ Erro na sincronização:', error);
    
    // Erro
    button.innerHTML = '<span>❌</span><span>Erro</span>';
    button.style.background = 'linear-gradient(135deg,rgba(255,71,87,.3),rgba(255,71,87,.5))';
    
    // Resetar botão após 3 segundos
    setTimeout(() => {
      button.disabled = false;
      button.classList.remove('syncing');
      button.innerHTML = '<span>🔄</span><span>Sync</span>';
      button.style.background = '';
    }, 3000);
  }
}

// Função para atualizar timestamp da última sincronização
function updateLastSyncTime() {
  const lastUpdateElement = document.getElementById('lastUpdate');
  if (lastUpdateElement) {
    const now = new Date();
    const timeString = now.toLocaleTimeString('pt-BR', { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    lastUpdateElement.textContent = timeString;
  }
}
</script>
</body>
</html>
