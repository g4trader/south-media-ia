<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard - Cliente Teste - Campanha Video CPV</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{--bg:#0F1023;--bg2:#16213E;--panel:#1A1A2E;--muted:#9CA3AF;--stroke: rgba(139,92,246,.28);
         --grad: linear-gradient(135deg,#8B5CF6,#EC4899);}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;
       background:linear-gradient(135deg,var(--bg) 0%,var(--bg2) 50%,var(--panel) 100%)}
  .container{max-width:1320px;margin:0 auto;padding:32px 32px 40px}
  .card{background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:14px;padding:20px;margin-bottom:24px;backdrop-filter:blur(8px)}
  .header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:20px}
  .logo{display:flex;align-items:center;gap:12px}
  .logo-icon{width:40px;height:40px;border-radius:10px;background:var(--grad);display:grid;place-items:center;font-weight:700}
  .muted{color:var(--muted)}
  .tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:20px 0}
  .tab{border:1px solid rgba(148,163,184,.2);background:rgba(255,255,255,.04);padding:10px;border-radius:10px;text-align:center;cursor:pointer;color:var(--muted);font-weight:600}
  .tab.active{background:var(--grad);color:#fff;box-shadow:0 8px 24px rgba(139,92,246,.35)}
  .hidden{display:none}
  .metrics{display:grid;grid-template-columns:repeat(6,1fr);gap:16px}
  @media(max-width:1200px){.metrics{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:900px){.metrics{grid-template-columns:repeat(2,1fr)} .tabs{grid-template-columns:repeat(2,1fr)} }
  .metric{border:1px solid rgba(148,163,184,.18);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:6px}
  .metric .label{text-transform:uppercase;letter-spacing:.06em;color:var(--muted);font-size:.82rem}
  .metric .value{font-size:1.7rem;font-weight:800;line-height:1.15}
  .kpis{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  @media(max-width:900px){.kpis{grid-template-columns:1fr}}
  table{width:100%;border-collapse:collapse}
  thead th{color:var(--muted);text-transform:uppercase;letter-spacing:.06em;font-size:.8rem;text-align:left;border-bottom:1px solid rgba(148,163,184,.22);padding:1rem}
  tbody td{padding:1rem;border-bottom:1px solid rgba(148,163,184,.14)}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(0,255,136,.2);border:1px solid rgba(0,255,136,.4);font-weight:600;color:#00ff88}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">
      <div class="logo-icon">üìä</div>
      <div>
        <h1>Cliente Teste</h1>
        <p class="muted">Campanha Video CPV - Video Program√°tica (Cost Per View)</p>
      </div>
    </div>
    <div class="badge">Ativa</div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('overview')">Vis√£o Geral</div>
    <div class="tab" onclick="showTab('channel')">Por Canal</div>
    <div class="tab" onclick="showTab('planning')">Planejamento</div>
    <div class="tab" onclick="showTab('insights')">An√°lise & Insights</div>
  </div>

  <!-- Vis√£o Geral -->
  <div id="overview" class="tab-content">
    <div class="card">
      <h3 style="margin-bottom:10px">Resumo da Campanha</h3>
      <div class="muted" style="margin-bottom:10px">Dashboard de performance para a campanha Campanha Video CPV do cliente Cliente Teste</div>
      <div style="overflow:auto">
        <table id="tableChannels">
          <thead>
            <tr>
              <th>Canal</th>
              <th>{{METRIC_INVESTMENT_LABEL}} (R$)</th>
              <th>{{METRIC_BUDGET_UTILIZED_LABEL}} (R$)</th>
              <th>Pacing (%)</th>
              <th>{{METRIC_PRIMARY_DELIVERED_LABEL}}</th>
              <th>{{SECONDARY_CLICKS_LABEL}}</th>
              <th>{{SECONDARY_CTR_LABEL}}</th>
              <th>{{SECONDARY_COMPLETE_VIEWS_LABEL}}</th>
              <th>{{SECONDARY_VTR_LABEL}}</th>
              <th>{{METRIC_PRIMARY_COST_LABEL}}</th>
              <th>{{SECONDARY_CPM_LABEL}}</th>
            </tr>
          </thead>
          <tbody id="tbodyChannels"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Por Canal -->
  <div id="channel" class="tab-content hidden">
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div style="font-weight:800">Canal:</div>
        <div style="padding:8px 10px;border-radius:8px;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.06);color:#fff">Video Program√°tica</div>
      </div>
    </div>
    
    <!-- Cards de Totalizadores das Principais M√©tricas de Entrega -->
    <div class="metrics" id="metrics-channel-summary" style="margin-bottom: 24px;">
      <div class="metric">
        <div class="label">{{METRIC_INVESTMENT_LABEL}}</div>
        <div class="value" id="total-investment">R$ 0,00</div>
      </div>
      <div class="metric">
        <div class="label">{{METRIC_BUDGET_UTILIZED_LABEL}}</div>
        <div class="value" id="total-budget-utilized">0%</div>
      </div>
      <div class="metric">
        <div class="label">{{METRIC_PRIMARY_CONTRACTED_LABEL}}</div>
        <div class="value" id="total-primary-contracted">0</div>
      </div>
      <div class="metric">
        <div class="label">{{METRIC_PRIMARY_DELIVERED_LABEL}}</div>
        <div class="value" id="total-primary-delivered">0</div>
      </div>
      <div class="metric">
        <div class="label">{{METRIC_PRIMARY_COST_LABEL}}</div>
        <div class="value" id="total-primary-cost">R$ 0,00</div>
      </div>
      <div class="metric">
        <div class="label">{{SECONDARY_VTR_LABEL}}</div>
        <div class="value" id="total-vtr">0%</div>
      </div>
    </div>
    
    <div class="metrics" id="metrics-channel"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin-bottom:10px">{{CHART_DAILY_PERFORMANCE_TITLE}} ‚Äî Video Program√°tica</h3>
      <div style="overflow:auto">
        <table id="channelDailyTable">
          <thead>
            <tr>
              <th>Data</th>
              <th>Budget (R$)</th>
              <th>{{METRIC_PRIMARY_DELIVERED_LABEL}}</th>
              <th>{{SECONDARY_CLICKS_LABEL}}</th>
              <th>{{SECONDARY_CTR_LABEL}}</th>
              <th>{{SECONDARY_COMPLETE_VIEWS_LABEL}}</th>
              <th>{{SECONDARY_VTR_LABEL}}</th>
              <th>{{METRIC_PRIMARY_COST_LABEL}}</th>
              <th>{{SECONDARY_CPM_LABEL}}</th>
            </tr>
          </thead>
          <tbody id="channelDailyBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Planejamento -->
  <div id="planning" class="tab-content hidden">
    <div class="card">
      <h3>Informa√ß√µes do Contrato</h3>
      <div class="metrics">
        <div class="metric">
          <div class="label">Cliente</div>
          <div class="value" id="client-name">Cliente Teste</div>
        </div>
        <div class="metric">
          <div class="label">Canal</div>
          <div class="value" id="channel-name">Video Program√°tica</div>
        </div>
        <div class="metric">
          <div class="label">Tipo de Compra</div>
          <div class="value" id="kpi-type">Cost Per View</div>
        </div>
        <div class="metric">
          <div class="label">Per√≠odo</div>
          <div class="value" id="period">N/A</div>
        </div>
      </div>
    </div>
  </div>

  <!-- An√°lise & Insights -->
  <div id="insights" class="tab-content hidden">
    <div class="card">
      <h3>Insights Autom√°ticos</h3>
      <div id="insights-content">
        <!-- Insights ser√£o gerados dinamicamente -->
      </div>
    </div>
  </div>
</div>

<script>
// Configura√ß√£o din√¢mica baseada no KPI
const KPI_CONFIG = {
  primaryMetric: '{{CHART_DAILY_PERFORMANCE_METRIC}}',
  yAxisLabel: '{{CHART_DAILY_PERFORMANCE_Y_AXIS}}',
  publisherMetric: '{{CHART_PUBLISHER_BREAKDOWN_METRIC}}'
};

// Fun√ß√£o para mostrar abas
function showTab(tabName) {
  // Esconder todas as abas
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.add('hidden');
  });
  
  // Remover classe active de todas as tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Mostrar aba selecionada
  document.getElementById(tabName).classList.remove('hidden');
  
  // Adicionar classe active na tab clicada
  event.target.classList.add('active');
}

// Fun√ß√£o para carregar dados
async function loadDashboardData() {
  try {
    const response = await fetch('https://mvp-dashboard-builder-6f3ckz7c7q-uc.a.run.app/api/teste_cpv_final/data');
    const data = await response.json();
    
    if (data.success) {
      updateDashboard(data.data);
    } else {
      console.error('Erro ao carregar dados:', data.message);
    }
  } catch (error) {
    console.error('Erro na requisi√ß√£o:', error);
  }
}

// Fun√ß√£o para atualizar dashboard
function updateDashboard(data) {
  // Atualizar m√©tricas principais baseadas no KPI
  updatePrimaryMetrics(data);
  
  // Atualizar gr√°ficos
  updateCharts(data);
  
  // Atualizar tabelas
  updateTables(data);
  
  // Gerar insights
  generateInsights(data);
}

// Fun√ß√£o para atualizar m√©tricas principais
function updatePrimaryMetrics(data) {
  const summary = data.campaign_summary || {};
  
  // M√©tricas din√¢micas baseadas no KPI
  document.getElementById('total-investment').textContent = formatCurrency(summary.investment || 0);
  document.getElementById('total-budget-utilized').textContent = formatPercentage(summary.budget_utilized || 0);
  
  // M√©tricas espec√≠ficas do KPI ser√£o atualizadas dinamicamente
  updateKPISpecificMetrics(summary);
}

// Fun√ß√£o para atualizar m√©tricas espec√≠ficas do KPI
function updateKPISpecificMetrics(summary) {
  // Esta fun√ß√£o ser√° adaptada baseada no KPI contratado
  // Exemplo para CPV:
  document.getElementById('total-primary-contracted').textContent = formatNumber(summary.views_contracted || 0);
  document.getElementById('total-primary-delivered').textContent = formatNumber(summary.views_delivered || 0);
  document.getElementById('total-primary-cost').textContent = formatCurrency(summary.cpv_contracted || 0);
  document.getElementById('total-vtr').textContent = formatPercentage(summary.vtr || 0);
}

// Fun√ß√µes de formata√ß√£o
function formatCurrency(value) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(value);
}

function formatPercentage(value) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'percent',
    minimumFractionDigits: 1,
    maximumFractionDigits: 1
  }).format(value / 100);
}

function formatNumber(value) {
  return new Intl.NumberFormat('pt-BR').format(value);
}

// Carregar dados quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', loadDashboardData);
</script>
</body>
</html>
