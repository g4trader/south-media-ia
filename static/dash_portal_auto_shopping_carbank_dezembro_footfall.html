

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Portal Auto Shopping ‚Äî Carbank Dezembro (Footfall Display)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ==== INSIGHTS LOGIC ==== (COMENTADO - PER ainda n√£o definido)
// (function(){
  // Separate channels
//   const videoNames = ["YouTube","TikTok","Netflix","Disney","CTV"];
//   const isVideo = (r)=> videoNames.includes((r["Canal"]||"").trim());
  // const video = PER.filter(isVideo);
  // const display = PER.filter(r => (r["Canal"]||"").toLowerCase().includes("footfall"));

  // Video Efficiency: scatter VTR(%) vs CPV (R$) ‚Äî invert x-axis meaning: lower CPV is better
//   try {
//     const ctx = document.getElementById('insVideoEff');
//     if (ctx) {
//       const data = {
        // labels: video.map(r=>r["Canal"]),
//         datasets: [{
//           label: 'Canais de V√≠deo',
          // data: video.map(r=>({x: Number(r["CPV (R$)"]||0), y: Number(r["VTR (100%)"]||0)*100})),
//           pointRadius: 6
//         }]
//       };
//       new Chart(ctx, {
//         type: 'scatter',
//         data,
//         options: {
//           plugins:{legend:{display:false}},
//           scales:{
//             x:{title:{display:true,text:'CPV (R$) ‚Äî menor √© melhor'}},
//             y:{title:{display:true,text:'VTR100 (%) ‚Äî maior √© melhor'}, suggestedMax: 100}
//           }
//         }
//       });
//     }
//   } catch(e){}


  // Pacing: Utilizado vs Contratado
//   try {
//     const ctx = document.getElementById('insPacing');
//     if (ctx) {
//       const contratado = Number(CONS["Budget Contratado (R$)"]||0);
//       const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
//       new Chart(ctx, {
//         type: 'bar',
//         data: {
//           labels: ['Pacing'],
//           datasets: [
//             { label: 'Contratado', data: [contratado] },
//             { label: 'Utilizado', data: [utilizado] }
//           ]
//         },
//         options: { plugins:{legend:{position:'bottom'}}, scales:{x:{stacked:true}, y:{stacked:true}} }
//       });
//     }
//   } catch(e){}

  // Insights text
//   try {
//     const list = document.getElementById('insightsList');
//     if (list) {
      // Best CPV among video
//       const videoValid = video.filter(r => r["CPV (R$)"]!=="" && r["VTR (100%)"]!=="");
//       const bestCPV = videoValid.reduce((acc,cur)=>{
//         const v = Number(cur["CPV (R$)"]||Infinity);
//         return (v < (acc.val||Infinity)) ? {name:cur["Canal"], val:v} : acc;
//       }, {});
//       const bestVTR = videoValid.reduce((acc,cur)=>{
//         const v = Number(cur["VTR (100%)"]||0);
//         return (v > (acc.val||-1)) ? {name:cur["Canal"], val:v} : acc;
//       }, {});


      // Pacing
//       const contratado = Number(CONS["Budget Contratado (R$)"]||0);
//       const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
//       const pacing = contratado>0 ? (utilizado/contratado) : 0;

//       const items = [];
//       if (bestCPV.name) items.push(`üé• Melhor CPV em v√≠deo: <b>${bestCPV.name}</b> (R$ ${bestCPV.val.toFixed(2)}).`);
//       if (bestVTR.name) items.push(`‚úÖ Maior VTR100: <b>${bestVTR.name}</b> (${(bestVTR.val*100).toFixed(1)}%).`);
//       items.push(`‚è±Ô∏è Pacing da campanha: <b>${(pacing*100).toFixed(1)}%</b> do contratado j√° foi utilizado.`);

//       if (!items.length) items.push("Sem insights suficientes ‚Äî verifique se os dados de PER/CONS est√£o preenchidos.");
//       list.innerHTML = items.map(t=>`<li>${t}</li>`).join("");
//     }
//   } catch(e){}
// })();

</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script>
// ==== INSIGHTS LOGIC ====
(function(){
  // CTR di√°rio (display)
  try {
    const ctx = document.getElementById('insVideoEff');
    if (ctx) {
      const dailyDisplay = DAILY.filter(r => (r.channel||'').toLowerCase()==='footfall display');
      const grouped = dailyDisplay.reduce((acc,r)=>{
        const d = r.date;
        if(!acc[d]) acc[d]={impressions:0, clicks:0};
        acc[d].impressions += Number(r.impressions||0);
        acc[d].clicks += Number(r.clicks||0);
        return acc;
      },{});
      const dates = Object.keys(grouped).sort((a,b)=>{
        const pa = a.split('/').reverse().join('-');
        const pb = b.split('/').reverse().join('-');
        return pa < pb ? -1 : pa > pb ? 1 : 0;
      });
      const ctrValues = dates.map(d=>{
        const g = grouped[d];
        return g.impressions>0 ? (g.clicks/g.impressions)*100 : 0;
      });
      const maxCtr = ctrValues.length ? Math.max(...ctrValues, 1) : 1;
      new Chart(ctx, {
        type: 'line',
        data: { labels: dates, datasets: [
          { label:'CTR (%)', data: ctrValues, borderColor:'#ff6b35', backgroundColor:'rgba(255,107,53,0.2)', tension:0.3, fill:false }
        ]},
        options: {
          plugins:{legend:{position:'bottom'}},
          scales:{
            y:{title:{display:true,text:'CTR (%)'}, suggestedMax: maxCtr},
          }
        }
      });
    }
  } catch(e){}


  // Pacing: Utilizado vs Contratado
  try {
    const ctx = document.getElementById('insPacing');
    if (ctx) {
      const contratado = Number(CONS["Budget Contratado (R$)"]||0);
      const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Pacing'],
          datasets: [
            { label: 'Contratado', data: [contratado] },
            { label: 'Utilizado', data: [utilizado] }
          ]
        },
        options: { plugins:{legend:{position:'bottom'}}, scales:{x:{stacked:true}, y:{stacked:true}} }
      });
    }
  } catch(e){}

  // Insights text
  try {
    const list = document.getElementById('insightsList');
    if (list) {
      // Pacing e performance display
      const contratado = Number(CONS["Budget Contratado (R$)"]||0);
      const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
      const pacing = contratado>0 ? (utilizado/contratado) : 0;
      const totalImp = Number(CONS["Impress√µes"]||0);
      const totalClicks = Number(CONS["Cliques"]||0);
      const ctrTotal = totalImp>0 ? (totalClicks/totalImp)*100 : 0;
      const metaImp = 120000;
      const entregaPct = metaImp>0 ? (totalImp/metaImp)*100 : 0;

      // Melhor CTR por dia
      const dailyDisplay = DAILY.filter(r => (r.channel||'').toLowerCase()==='footfall display');
      const grouped = dailyDisplay.reduce((acc,r)=>{
        const d = r.date;
        if(!acc[d]) acc[d]={impressions:0, clicks:0};
        acc[d].impressions += Number(r.impressions||0);
        acc[d].clicks += Number(r.clicks||0);
        return acc;
      },{});
      const bestCtr = Object.entries(grouped).reduce((acc,[date,val])=>{
        const ctr = val.impressions>0 ? (val.clicks/val.impressions)*100 : 0;
        return ctr > (acc.ctr||-1) ? {date, ctr} : acc;
      }, {});

      const items = [];
      items.push(`‚è±Ô∏è Pacing or√ßament√°rio: <b>${(pacing*100).toFixed(1)}%</b> do budget utilizado.`);
      items.push(`üìà Entrega de impress√µes: <b>${fmtInt(totalImp)}</b> (${entregaPct.toFixed(1)}% de 120.000 contratadas).`);
      items.push(`üéØ CTR m√©dio: <b>${ctrTotal.toFixed(2)}%</b>.`);
      if (bestCtr.date) items.push(`‚≠ê Melhor CTR di√°rio: <b>${bestCtr.ctr.toFixed(2)}%</b> em ${bestCtr.date}.`);

      list.innerHTML = items.map(t=>`<li>${t}</li>`).join("");
    }
  } catch(e){}
})();

</script>
<style>
  :root{--bg:#0F1023;--bg2:#16213E;--panel:#1A1A2E;--muted:#9CA3AF;--stroke: rgba(139,92,246,.28);
         --grad: linear-gradient(135deg,#8B5CF6,#EC4899);}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;
       background:linear-gradient(135deg,var(--bg) 0%,var(--bg2) 50%,var(--panel) 100%)}
  .container{max-width:1320px;margin:0 auto;padding:32px 32px 40px}
  .card{background:rgba(26,26,46,.8);border:1px solid var(--stroke);border-radius:14px;padding:20px;margin-bottom:24px;backdrop-filter:blur(8px)}
  .header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:20px}
  .logo{display:flex;align-items:center;gap:12px}
  .logo-icon{width:40px;height:40px;border-radius:10px;background:var(--grad);display:grid;place-items:center;font-weight:700}
  .muted{color:var(--muted)}
  .tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:20px 0}
  .tab{border:1px solid rgba(148,163,184,.2);background:rgba(255,255,255,.04);padding:10px;border-radius:10px;text-align:center;cursor:pointer;color:var(--muted);font-weight:600}
  .tab.active{background:var(--grad);color:#fff;box-shadow:0 8px 24px rgba(139,92,246,.35)}
  .hidden{display:none}
  .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
  @media(max-width:900px){.metrics{grid-template-columns:repeat(2,1fr)} .tabs{grid-template-columns:repeat(2,1fr)} }
  .metric{border:1px solid rgba(148,163,184,.18);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:6px}
  .metric .label{text-transform:uppercase;letter-spacing:.06em;color:var(--muted);font-size:.82rem}
  .metric .value{font-size:1.7rem;font-weight:800;line-height:1.15}
  .kpis{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  @media(max-width:900px){.kpis{grid-template-columns:1fr}}
  table{width:100%;border-collapse:collapse}
  thead th{color:var(--muted);text-transform:uppercase;letter-spacing:.06em;font-size:.8rem;text-align:left;border-bottom:1px solid rgba(148,163,184,.22);padding:1rem}
  tbody td{padding:1rem;border-bottom:1px solid rgba(148,163,184,.14)}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background:rgba(0,255,136,.2);border:1px solid rgba(0,255,136,.4);font-weight:600;color:#00ff88}

        @keyframes heatmap-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        .marker-cluster {
            background-color: rgba(255, 107, 53, 0.8);
            border-radius: 50%;
            color: white;
            text-align: center;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .marker-cluster-small {
            width: 40px;
            height: 40px;
            line-height: 36px;
            font-size: 14px;
        }
        
        .marker-cluster-medium {
            width: 50px;
            height: 50px;
            line-height: 46px;
            font-size: 16px;
        }
        
        .marker-cluster-large {
            width: 60px;
            height: 60px;
            line-height: 56px;
            font-size: 18px;
        }
    </style>
</head>
<body>
<div class="container">
  <div class="card header">
    <div class="logo">
      <div class="logo-icon">SM</div>
      <div>
        <div style="font-weight:800;font-size:1.1rem">South Media</div>
        <div class="muted">Portal Auto Shopping ‚Äî Carbank Dezembro (Footfall Display)</div>
      </div>
    </div>
    <div>
      <div style="font-weight:700;font-size:1rem;text-align:right">Campanha: Carbank Dez/2025</div>
      <div class="muted" style="text-align:right">Status: <span class="badge">EM ANDAMENTO</span></div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="overview">üé¨ Vis√£o Geral</div>
    <div class="tab" data-tab="channels">üß≠ Por Canal</div>
    <div class="tab" data-tab="insights">üìä An√°lise & Insights</div>
    <div class="tab" data-tab="planning">üìã Planejamento</div>
    <div class="tab" data-tab="footfall">üë£ Footfall</div>
  </div>

  <!-- OVERVIEW -->
  <div id="tab-overview">
    <div class="metrics" id="metrics-overview-top"></div>
    <div class="kpis">
      <div class="card"><canvas id="chartSpendShare"></canvas></div>
      <div class="card"><canvas id="chartResults"></canvas></div>
    </div>
    <div class="card" style="margin-top:16px">
      <h3 style="margin-bottom:10px">Resumo por Canal</h3>
      <div class="muted" style="margin-bottom:10px">Valores contratados vs. realizados.</div>
      <div style="overflow:auto">
        <table id="tableChannels">
          <thead>
            <tr>
              <th>Canal</th><th>Budget Contratado (R$)</th><th>Budget Utilizado (R$)</th><th>Pacing (%)</th>
              <th>Impress√µes</th><th>Cliques</th><th>CTR</th><th>VC (100%)</th><th>VTR (100%)</th>
              <th>CPV (R$)</th><th>CPM (R$)</th>
            </tr>
          </thead>
          <tbody id="tbodyChannels"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- CHANNELS -->
  <div id="tab-channels" class="hidden">
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <div style="font-weight:800">Selecione o canal:</div>
        <select id="channelSelect" style="padding:8px 10px;border-radius:8px;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.06);color:#fff"></select>
      </div>
    </div>
    <div class="metrics" id="metrics-channel"></div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin-bottom:10px">Entrega di√°ria ‚Äî <span id="channelNameSpan">‚Äî</span></h3>
      <div style="overflow:auto">
        <table id="channelDailyTable">
          <thead>
            <tr>
              <th>Data</th><th>Criativo</th><th>Investimento (R$)</th>
              <th>Starts</th><th>25%</th><th>50%</th><th>75%</th><th>100%</th>
              <th>Impress√µes</th><th>Cliques</th><th>Visitas</th>
            </tr>
          </thead>
          <tbody id="channelDailyBody"></tbody>
        </table>
      </div>
    </div>

    <div id="footfallExtras" class="hidden">
      <div class="card" style="margin-top:16px">
        <h3 style="margin-bottom:10px">Formatos usados no Footfall Display</h3>
        <ul style="columns:2; gap:24px; margin-left:18px">
          <li>360x300 (A)</li><li>300x250 (A)</li><li>300x50 (A)</li><li>320x480 (A)</li><li>336x336 (A)</li>
        </ul>
      </div>
    </div>

    <div id="ctvPublishers" class="hidden">
      <div class="card" style="margin-top:16px">
        <h3 style="margin-bottom:10px">Publishers utilizados (CTV)</h3>
        <ul style="columns:2; gap:24px; margin-left:18px">
          <li>Pluto TV - Watch Free Movies, Shows & Live TV - FireTv (B00KDSGIPK)</li>
          <li>Plex: Stream Movies & TV - Android Tv</li>
          <li>Pluto TV Television Gratis Channels | Roku Channel Store | Roku - Roku</li>
          <li>Pluto TV - LG Tv</li>
          <li>LG Channels - LG Tv (474310)</li>
          <li>Live TV - Android Tv</li>
          <li>RecordPlus - Android Tv</li>
          <li>Rainbow Dash - FireTv (B079X4ZZ4T)</li>
          <li>Samsung TV - Android TV</li>
          <li>Xiaomi TV+: Watch Live TV - Android Tv</li>
          <li>TCL CHANNEL - Android Tv</li>
          <li>Plex Free Movies and TV</li>
          <li>MovieArk: Stream Movies & Live - Android Tv</li>
        </ul>
      </div>
    </div>
  </div>

  
  <!-- INSIGHTS -->
  <div id="tab-insights" class="hidden">
    <div class="card" style="margin-bottom:16px">
      <h3 style="margin-bottom:8px">Pacing da Campanha</h3>
      <div class="muted" style="margin-bottom:8px">Or√ßamento Utilizado vs Contratado (quanto j√° foi gasto).</div>
      <canvas id="insPacing"></canvas>
    </div>

    <div class="card" id="insightsCards">
      <h3 style="margin-bottom:8px">Resumo de Insights</h3>
      <ul id="insightsList" style="margin-left:18px;line-height:1.75"></ul>
    </div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin-bottom:10px">Otimiza√ß√µes Recomendadas</h3>
      <ul style="margin:0; padding-left:18px; line-height:1.6; color:rgba(148,163,184,0.9)">
        <li><strong>Footfall Display:</strong> Priorizar formatos com CTR mais alto (300x250 e 336x336).</li>
        <li><strong>Footfall Display:</strong> Garantir entrega m√≠nima di√°ria para manter pacing de impress√µes.</li>
        <li><strong>Footfall Display:</strong> Revisar publishers com CTR baixo e realocar para invent√°rio mais responsivo.</li>
      </ul>
    </div>
  </div>

  <!-- PLANEJAMENTO -->

    <div id="tab-planning" class="hidden">
  <div class="card" style="margin-bottom:16px">
    <h3 style="margin-bottom:10px">Planejamento da Campanha</h3>
    <p style="margin:0; line-height:1.5; color:rgba(148,163,184,0.9)">
      Cliente: Portal Auto Shopping ¬∑ Campanha: Carbank Dezembro ¬∑ Canal: Drive to store ¬∑ Criativos: Banners
    </p>
  </div>

  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px; margin-bottom:16px">
    <div class="card">
      <h3 style="margin-bottom:10px">Cronograma & Investimento</h3>
      <ul style="margin:0; padding-left:18px; line-height:1.6; color:rgba(148,163,184,0.9)">
        <li>Per√≠odo: <span id="plan-periodo"></span></li>
        <li>Budget Total: R$ <span id="plan-budget-total"></span></li>
        <li>Budget Utilizado: R$ <span id="plan-budget-used"></span></li>
        <li>Pacing: <span id="plan-pacing"></span></li>
      </ul>
    </div>

    <div class="card">
      <h3 style="margin-bottom:10px">M√©tricas Contratadas</h3>
      <ul style="margin:0; padding-left:18px; line-height:1.6; color:rgba(148,163,184,0.9)">
        <li>Meta Impress√µes: <span id="plan-imp-meta"></span></li>
        <li>Imp Entregues: <span id="plan-imp-entregues"></span></li>
        <li>Pacing Imp: <span id="plan-imp-pacing"></span></li>
        <li>CPM Contratado: R$ <span id="plan-cpm"></span></li>
      </ul>
    </div>
  </div>

  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px; margin-bottom:16px">
    <div class="card" style="grid-column: span 1;">
      <h3 style="margin-bottom:10px">Publishers</h3>
      <div style="overflow:auto">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="text-align:left; color:rgba(255,255,255,0.7);">
              <th style="padding:8px 6px;">Nome</th>
              <th style="padding:8px 6px;">App/URL</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:8px 6px;">drivetostore</td>
              <td style="padding:8px 6px;">drivetostore.com</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card" style="grid-column: span 1;">
      <h3 style="margin-bottom:10px">Pra√ßas</h3>
      <p style="margin:0; line-height:1.6; color:rgba(148,163,184,0.9)">
        Campanha entregue nas cidades e estados selecionados na campanha.
      </p>
    </div>
  </div>

  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:16px;">
    <div class="card">
      <h3 style="margin-bottom:10px">Segmenta√ß√µes</h3>
      <p style="margin:0; line-height:1.6; color:rgba(148,163,184,0.9)">n/a</p>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px">Tipo de criativo</h3>
      <p style="margin:0; line-height:1.6; color:rgba(148,163,184,0.9)">Banners</p>
    </div>
    <div class="card">
      <h3 style="margin-bottom:10px">Canal</h3>
      <p style="margin:0; line-height:1.6; color:rgba(148,163,184,0.9)">Drive to store</p>
    </div>
  </div>
</div>
<!-- FOOTFALL -->
  <div id="tab-footfall" class="hidden">
    <!-- Hero Section -->
    <section class="hero" style="text-align: center; margin-bottom: 2rem; padding: 2rem 0;">
      <span style="color: #ff6b35; text-transform: uppercase; font-size: 1rem; font-weight: 600; margin-bottom: 1rem; display: block;">Portal Auto Shopping ¬∑ Carbank Dezembro</span>
      <h1 style="font-size: 2.5rem; font-weight: bold; color: #ffffff; margin-bottom: 1rem; letter-spacing: 1px;">AN√ÅLISE DE FOOTFALL - DISPLAY</h1>
      <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.1rem; max-width: 600px; margin: 0 auto;">Monitoramento di√°rio do tr√°fego gerado pelo canal Footfall Display durante a campanha de dezembro</p>
    </section>

    <!-- Metrics -->
    <section class="metrics-grid" id="footfall-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
      <div class="loading" style="display: flex; justify-content: center; align-items: center; height: 200px; flex-direction: column; gap: 1rem;">
        <div class="spinner" style="width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.1); border-top: 4px solid #ff6b35; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p>Carregando dados...</p>
      </div>
    </section>

    <!-- Content Grid -->
    <section class="content-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
      <!-- Map -->
      <div class="card">
        <div class="card-header" style="padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(139, 92, 246, 0.1));">
          <h3 class="card-title" style="font-size: 1.25rem; font-weight: bold; color: #ffffff; margin-bottom: 0.5rem;">Distribui√ß√£o Geogr√°fica</h3>
          <p class="card-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Mapa interativo com localiza√ß√£o das lojas e intensidade de footfall</p>
        </div>
        <div class="card-content" style="padding: 1.5rem;">
          <div id="footfall-map" style="height: 400px; width: 100%; border-radius: 8px; filter: hue-rotate(15deg) saturate(1.2);"></div>
          <div class="legend" style="display: flex; justify-content: center; gap: 2rem; margin-top: 1rem; font-size: 0.8rem;">
            <div class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <div class="legend-color" style="width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px rgba(255, 107, 53, 0.3); background: #ff6b35;"></div>
              <span>Alta (‚â•10%)</span>
            </div>
            <div class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <div class="legend-color" style="width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px rgba(255, 107, 53, 0.3); background: #8b5cf6;"></div>
              <span>M√©dia (5-10%)</span>
            </div>
            <div class="legend-item" style="display: flex; align-items: center; gap: 0.5rem;">
              <div class="legend-color" style="width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px rgba(255, 107, 53, 0.3); background: #00ff88;"></div>
              <span>Baixa (&lt;5%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="card">
        <div class="card-header" style="padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(139, 92, 246, 0.1));">
          <h3 class="card-title" style="font-size: 1.25rem; font-weight: bold; color: #ffffff; margin-bottom: 0.5rem;">Performance por Loja</h3>
          <p class="card-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Distribui√ß√£o de usu√°rios footfall por taxa de convers√£o</p>
        </div>
        <div class="card-content" style="padding: 1.5rem;">
          <div class="chart-container" style="height: 300px; position: relative;">
            <canvas id="footfall-performanceChart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Top Stores -->
    <section class="card top-stores">
      <div class="card-header" style="padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(139, 92, 246, 0.1));">
        <h3 class="card-title" style="font-size: 1.25rem; font-weight: bold; color: #ffffff; margin-bottom: 0.5rem;">Top 5 Lojas por Footfall</h3>
        <p class="card-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Ranking das lojas com maior n√∫mero de usu√°rios detectados</p>
      </div>
      <div id="footfall-topStores">
        <div class="loading" style="display: flex; justify-content: center; align-items: center; height: 200px; flex-direction: column; gap: 1rem;">
          <div class="spinner" style="width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.1); border-top: 4px solid #ff6b35; border-radius: 50%; animation: spin 1s linear infinite;"></div>
          <p>Carregando ranking...</p>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
const CONS = {
  "Budget Contratado (R$)": 3000.0,
  "Budget Utilizado (R$)": 3140.83,
  "Impress√µes": 125624,
  "Cliques": 3013,
  "CTR (%)": 0.023984,
  "VC (100%)": 0,
  "VTR (100%)": 0,
  "CPV (R$)": 0,
  "CPM (R$)": 25.0,
  "Pacing (%)": 1.04694
};






const PER = [
  {
    "Canal": "Footfall Display",
    "Budget Contratado (R$)": 3000.0,
    "Budget Utilizado (R$)": 3140.83,
    "Impress√µes": 125624,
    "Cliques": 3013,
    "CTR (%)": 0.023984,
    "VC (100%)": 0,
    "VTR (100%)": 0,
    "CPV (R$)": 0,
    "CPM (R$)": 25.0,
    "Pacing (%)": 1.04694,
    "Criativos √önicos": 5
  }
];






const DAILY = [
  {"date":"04/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":20.8,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":832,"clicks":6,"visits":0},
  {"date":"04/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":21.33,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":853,"clicks":24,"visits":0},
  {"date":"04/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":21.2,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":848,"clicks":0,"visits":0},
  {"date":"04/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":21.38,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":855,"clicks":0,"visits":0},
  {"date":"04/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":22.45,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":898,"clicks":14,"visits":0},
  {"date":"05/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":17.58,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":703,"clicks":0,"visits":0},
  {"date":"05/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":17.8,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":712,"clicks":32,"visits":0},
  {"date":"05/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":18.23,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":729,"clicks":0,"visits":0},
  {"date":"05/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":18.88,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":755,"clicks":0,"visits":0},
  {"date":"05/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":19.23,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":769,"clicks":7,"visits":0},
  {"date":"06/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":24.28,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":971,"clicks":0,"visits":0},
  {"date":"06/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":24.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":966,"clicks":32,"visits":0},
  {"date":"06/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":22.75,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":910,"clicks":0,"visits":0},
  {"date":"06/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":22.83,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":913,"clicks":0,"visits":0},
  {"date":"06/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":24.7,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":988,"clicks":14,"visits":0},
  {"date":"07/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":15.83,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":633,"clicks":0,"visits":0},
  {"date":"07/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":16.98,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":679,"clicks":22,"visits":0},
  {"date":"07/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":15.35,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":614,"clicks":0,"visits":0},
  {"date":"07/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":17.43,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":697,"clicks":0,"visits":0},
  {"date":"07/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":15.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":602,"clicks":8,"visits":0},
  {"date":"08/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.03,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1,"clicks":0,"visits":0},
  {"date":"08/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":3.55,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":142,"clicks":11,"visits":0},
  {"date":"08/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":8.2,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":328,"clicks":2,"visits":0},
  {"date":"08/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":0.63,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":25,"clicks":0,"visits":0},
  {"date":"08/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.03,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1,"clicks":0,"visits":0},
  {"date":"09/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2,"clicks":0,"visits":0},
  {"date":"09/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":44.48,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1779,"clicks":68,"visits":0},
  {"date":"09/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":5.93,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":237,"clicks":2,"visits":0},
  {"date":"09/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":21.5,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":860,"clicks":90,"visits":0},
  {"date":"09/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"10/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":6,"clicks":0,"visits":0},
  {"date":"10/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":40.78,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1631,"clicks":33,"visits":0},
  {"date":"10/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":12.13,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":485,"clicks":5,"visits":0},
  {"date":"10/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":23.9,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":956,"clicks":27,"visits":0},
  {"date":"10/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"11/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2,"clicks":0,"visits":0},
  {"date":"11/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":33.58,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1343,"clicks":57,"visits":0},
  {"date":"11/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":9.65,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":386,"clicks":4,"visits":0},
  {"date":"11/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":30.23,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1209,"clicks":64,"visits":0},
  {"date":"11/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"12/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":27.8,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1112,"clicks":0,"visits":0},
  {"date":"12/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":32.85,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1314,"clicks":49,"visits":0},
  {"date":"12/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":33.23,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1329,"clicks":9,"visits":0},
  {"date":"12/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":29.03,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1161,"clicks":54,"visits":0},
  {"date":"12/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"13/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":58.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2322,"clicks":0,"visits":0},
  {"date":"13/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":36.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1440,"clicks":56,"visits":0},
  {"date":"13/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":33.5,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1340,"clicks":2,"visits":0},
  {"date":"13/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":34.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1366,"clicks":53,"visits":0},
  {"date":"13/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"14/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":25.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1002,"clicks":0,"visits":0},
  {"date":"14/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":42.6,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1704,"clicks":49,"visits":0},
  {"date":"14/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":56.2,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2248,"clicks":1,"visits":0},
  {"date":"14/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":42.6,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1704,"clicks":68,"visits":0},
  {"date":"14/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"15/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.33,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":13,"clicks":0,"visits":0},
  {"date":"15/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":55.7,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2228,"clicks":67,"visits":0},
  {"date":"15/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":9.8,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":392,"clicks":3,"visits":0},
  {"date":"15/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":28.5,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1140,"clicks":42,"visits":0},
  {"date":"15/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"16/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.7,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":28,"clicks":0,"visits":0},
  {"date":"16/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":125.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":5006,"clicks":60,"visits":0},
  {"date":"16/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":85.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":3400,"clicks":8,"visits":0},
  {"date":"16/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":36.78,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1471,"clicks":69,"visits":0},
  {"date":"16/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.55,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":22,"clicks":0,"visits":0},
  {"date":"17/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":44.45,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1778,"clicks":61,"visits":0},
  {"date":"17/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":11.23,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":449,"clicks":5,"visits":0},
  {"date":"17/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":22.7,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":908,"clicks":38,"visits":0},
  {"date":"17/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":62.63,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2505,"clicks":75,"visits":0},
  {"date":"17/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"18/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.35,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":14,"clicks":0,"visits":0},
  {"date":"18/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":41.43,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1657,"clicks":45,"visits":0},
  {"date":"18/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":15.73,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":629,"clicks":3,"visits":0},
  {"date":"18/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":21.7,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":868,"clicks":27,"visits":0},
  {"date":"18/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"19/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.35,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":14,"clicks":0,"visits":0},
  {"date":"19/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":25.85,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1034,"clicks":47,"visits":0},
  {"date":"19/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":14.85,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":594,"clicks":4,"visits":0},
  {"date":"19/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":18.88,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":755,"clicks":39,"visits":0},
  {"date":"19/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"20/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.3,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":12,"clicks":0,"visits":0},
  {"date":"20/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":39.55,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1582,"clicks":31,"visits":0},
  {"date":"20/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":9.55,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":382,"clicks":4,"visits":0},
  {"date":"20/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":17.45,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":698,"clicks":39,"visits":0},
  {"date":"20/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"21/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.43,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":17,"clicks":0,"visits":0},
  {"date":"21/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":15.75,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":630,"clicks":28,"visits":0},
  {"date":"21/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":1.4,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":56,"clicks":0,"visits":0},
  {"date":"21/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":24.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":966,"clicks":169,"visits":0},
  {"date":"21/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"22/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":0.38,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":15,"clicks":0,"visits":0},
  {"date":"22/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":12.45,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":498,"clicks":2,"visits":0},
  {"date":"22/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":179.2,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":7168,"clicks":6,"visits":0},
  {"date":"22/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":63.3,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2532,"clicks":498,"visits":0},
  {"date":"22/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"23/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":45.4,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1816,"clicks":0,"visits":0},
  {"date":"23/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":29.1,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1164,"clicks":8,"visits":0},
  {"date":"23/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":47.78,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1911,"clicks":1,"visits":0},
  {"date":"23/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":30.68,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1227,"clicks":234,"visits":0},
  {"date":"23/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"24/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":47.88,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1915,"clicks":0,"visits":0},
  {"date":"24/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":18.88,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":755,"clicks":28,"visits":0},
  {"date":"24/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":29.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1160,"clicks":3,"visits":0},
  {"date":"24/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":20.1,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":804,"clicks":60,"visits":0},
  {"date":"24/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"25/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":37.83,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1513,"clicks":0,"visits":0},
  {"date":"25/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":33.53,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1341,"clicks":42,"visits":0},
  {"date":"25/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":24.18,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":967,"clicks":7,"visits":0},
  {"date":"25/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":46.08,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1843,"clicks":38,"visits":0},
  {"date":"25/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"26/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":50.28,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2011,"clicks":0,"visits":0},
  {"date":"26/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":26.15,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1046,"clicks":55,"visits":0},
  {"date":"26/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":55.6,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2224,"clicks":0,"visits":0},
  {"date":"26/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":70.05,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2802,"clicks":46,"visits":0},
  {"date":"26/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"27/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":25.13,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1005,"clicks":0,"visits":0},
  {"date":"27/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":62.8,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2512,"clicks":52,"visits":0},
  {"date":"27/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":56.18,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2247,"clicks":3,"visits":0},
  {"date":"27/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":70.58,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2823,"clicks":35,"visits":0},
  {"date":"27/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"28/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":25.5,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1020,"clicks":0,"visits":0},
  {"date":"28/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":58.85,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2354,"clicks":42,"visits":0},
  {"date":"28/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":29.3,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1172,"clicks":2,"visits":0},
  {"date":"28/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":52.98,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":2119,"clicks":38,"visits":0},
  {"date":"28/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0},
  {"date":"29/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store-360x300_A.png","spend":5.6,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":224,"clicks":0,"visits":0},
  {"date":"29/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x250px_A.png","spend":42.3,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":1692,"clicks":53,"visits":0},
  {"date":"29/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_300x50px_A.png","spend":8.03,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":321,"clicks":0,"visits":0},
  {"date":"29/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_320x480px_A.png","spend":20.33,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":813,"clicks":33,"visits":0},
  {"date":"29/12/2025","channel":"Footfall Display","creative":"20251201_ly_Drive-To-Store_336x336px_A.png","spend":0.0,"starts":0,"q25":0,"q50":0,"q75":0,"q100":0,"impressions":0,"clicks":0,"visits":0}
];

// Dados de footfall (aba Footfall da planilha)
// Fonte: aba Footfall da planilha Portal Auto Shopping ‚Äî Drive to store
// https://docs.google.com/spreadsheets/d/10AKOXuxx5vC2BlZ3tp1CxTlcIlxIj2-G8av0ramCOeg/edit?gid=1714301106#gid=1714301106
const FOOTFALL_POINTS = [
  {
    "lat": -19.9077882899644,
    "lon": -43.9592569000019,
    "name": "Av. Dom Pedro II, 1900 - Carlos Prates, Belo Horizonte - MG, 30710-010",
    "users": 93,
    "rate": 8.5
  }
];
// Helpers
const fmtBR = (v, dec=2) => isNaN(v)||v===null||v==="" ? "‚Äî" :
  new Intl.NumberFormat('pt-BR',{minimumFractionDigits:dec, maximumFractionDigits:dec}).format(Number(v));
const fmtInt = v => isNaN(v)||v===null||v==="" ? "‚Äî" :
  new Intl.NumberFormat('pt-BR',{maximumFractionDigits:0}).format(Number(v));
const pct = v => (isNaN(v)||v===null||v==="") ? "‚Äî" : `${(Number(v)*100).toFixed(2)}%`;

// Tabs
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const id = t.dataset.tab;
  ['overview','channels','insights','planning','footfall'].forEach(key=>{
    document.getElementById('tab-'+key).classList.toggle('hidden', key!==id);
  });
  
  // Inicializar Footfall quando a aba for clicada
  if (id === 'footfall') {
    initializeFootfallContent();
  }
}));

// OVERVIEW
const topMetrics = [
  ["üí∞ Or√ßamento Contratado", `R$ ${fmtBR(CONS["Budget Contratado (R$)"])}`],
  ["üí∏ Or√ßamento Utilizado", `R$ ${fmtBR(CONS["Budget Utilizado (R$)"])}`],
  ["üñ®Ô∏è Impress√µes", fmtInt(CONS["Impress√µes"])],
  ["üìà CTR", pct(CONS["CTR (%)"])],
];
document.getElementById('metrics-overview-top').innerHTML = topMetrics.map(
  m=>`<div class='metric'><div class='label'>${m[0]}</div><div class='value'>${m[1]}</div></div>`).join('');

// Overview table
const tbody = document.getElementById('tbodyChannels');
PER.forEach(r=>{
  tbody.insertAdjacentHTML('beforeend', `
    <tr>
      <td>${r["Canal"]||"‚Äî"}</td>
      <td>R$ ${fmtBR(r["Budget Contratado (R$)"])}</td>
      <td>R$ ${fmtBR(r["Budget Utilizado (R$)"])}</td>
      <td>${pct(r["Pacing (%)"])}</td>
      <td>${fmtInt(r["Impress√µes"])}</td>
      <td>${fmtInt(r["Cliques"])}</td>
      <td>${pct(r["CTR (%)"])}</td>
      <td>${fmtInt(r["VC (100%)"])}</td>
      <td>${pct(r["VTR (100%)"])}</td>
      <td>R$ ${fmtBR(r["CPV (R$)"])}</td>
      <td>R$ ${fmtBR(r["CPM (R$)"])}</td>
    </tr>`)
});

// Overview charts
const ctx1 = document.getElementById('chartSpendShare');
const ctx2 = document.getElementById('chartResults');
const spendData = PER.map(r=>Number(r["Budget Utilizado (R$)"]||0));
const labels = PER.map(r=>r["Canal"]);
new Chart(ctx1, {
  type:'doughnut',
  data:{labels, datasets:[{data:spendData}]},
  options:{plugins:{legend:{position:'bottom'}}}
});
const impressions = PER.map(r=>Number(r["Impress√µes"]||0));
const ctr = PER.map(r=>(Number(r["CTR (%)"]||0))*100);
new Chart(ctx2, {
  type:'bar',
  data:{labels, datasets:[
    {label:'Impress√µes', data:impressions, yAxisID:'y'},
    {label:'CTR (%)', data:ctr, yAxisID:'y1'}
  ]},
  options:{
    responsive:true,
    plugins:{legend:{position:'bottom'}},
    scales:{
      y:{title:{display:true,text:'Impress√µes'}, ticks:{callback:v=>fmtInt(v)}},
      y1:{position:'right', title:{display:true,text:'CTR (%)'}, grid:{drawOnChartArea:false}}
    }
  }
});

// CHANNELS ‚Äî selector
const sel = document.getElementById('channelSelect');
PER.forEach(r=>{ const opt=document.createElement('option'); opt.value=r["Canal"]; opt.textContent=r["Canal"]; sel.appendChild(opt); });
const metricsChannel = document.getElementById('metrics-channel');
const channelNameSpan = document.getElementById('channelNameSpan');

// Verificar se os elementos existem
if (!metricsChannel) {
  console.error('Elemento metrics-channel n√£o encontrado');
}
if (!channelNameSpan) {
  console.error('Elemento channelNameSpan n√£o encontrado');
}

function renderChannelDailyTable(name){
  const tbody = document.getElementById('channelDailyBody');
  if (!tbody) {
    console.error('channelDailyBody n√£o encontrado');
    return;
  }
  tbody.innerHTML = "";
  
  if (!DAILY || DAILY.length === 0) {
    console.warn('Array DAILY est√° vazio ou n√£o definido');
    tbody.innerHTML = '<tr><td colspan="11" style="text-align:center;padding:2rem;">Nenhum dado dispon√≠vel</td></tr>';
    return;
  }
  
  const channelName = (name||'').toLowerCase().trim();
  const rows = DAILY.filter(r=> {
    const rChannel = (r.channel||'').toLowerCase().trim();
    return rChannel === channelName;
  }).sort((a,b)=>{ // date desc
    const pa = a.date.split('/').reverse().join('-');
    const pb = b.date.split('/').reverse().join('-');
    return pa<pb ? 1 : pa>pb ? -1 : 0;
  });
  
  console.log(`Renderizando ${rows.length} registros para canal "${name}"`);
  
  if (rows.length === 0) {
    tbody.innerHTML = '<tr><td colspan="11" style="text-align:center;padding:2rem;">Nenhum dado dispon√≠vel para este canal</td></tr>';
    return;
  }
  
  rows.forEach(r=>{
    tbody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${r.date||'‚Äî'}</td>
        <td>${r.creative||'‚Äî'}</td>
        <td>R$ ${fmtBR(r.spend)}</td>
        <td>${fmtInt(r.starts)}</td>
        <td>${fmtInt(r.q25)}</td>
        <td>${fmtInt(r.q50)}</td>
        <td>${fmtInt(r.q75)}</td>
        <td>${fmtInt(r.q100)}</td>
        <td>${fmtInt(r.impressions)}</td>
        <td>${fmtInt(r.clicks)}</td>
        <td>${fmtInt(r.visits)}</td>
      </tr>`);
  });
}


function renderChannel(name){
  console.log('renderChannel chamado com:', name);
  console.log('PER dispon√≠vel:', PER);
  console.log('DAILY dispon√≠vel:', DAILY ? `${DAILY.length} registros` : 'n√£o definido');
  
  const r = PER.find(x=> (x["Canal"]||'').toLowerCase()=== (name||'').toLowerCase()) || PER[0];
  const nm = r ? r['Canal'] : name;
  console.log('Canal encontrado:', nm);
  
  if (channelNameSpan) {
    channelNameSpan.textContent = nm || '‚Äî';
  }
  
  // Definir m√©tricas baseadas no tipo de canal
  const isVideoChannel = ['CTV', 'Disney', 'Netflix', 'YouTube'].includes(nm);
  const isDisplayChannel = nm === 'Footfall Display';
  const isMixedChannel = nm === 'TikTok';
  
  const items = [
    ['üìä Or√ßamento Contratado','R$ '+fmtBR(r['Budget Contratado (R$)'])],
    ['üí∏ Or√ßamento Utilizado','R$ '+fmtBR(r['Budget Utilizado (R$)'])],
    ['üéØ Pacing', pct(r['Pacing (%)'])],
  ];
  
  // Adicionar m√©tricas espec√≠ficas por tipo de canal
  if (isVideoChannel) {
    // Canais de v√≠deo: VTR e CPV
    items.push(
      ['üé¨ VC (100%)', fmtInt(r['VC (100%)'])],
      ['üìâ VTR100', pct(r['VTR (100%)'])],
      ['üí∞ CPV','R$ '+fmtBR(r['CPV (R$)'])]
    );
  } else if (isDisplayChannel) {
    // Canal de display: CPM
    items.push(
      ['üñ®Ô∏è Impress√µes', fmtInt(r['Impress√µes'])],
      ['üëÜ Cliques', fmtInt(r['Cliques'])],
      ['üìà CTR', pct(r['CTR (%)'])],
      ['üí∞ CPM','R$ '+fmtBR(r['CPM (R$)'])]
    );
  } else if (isMixedChannel) {
    // Canal misto (TikTok): VTR, CPV e CPM
    items.push(
      ['üé¨ VC (100%)', fmtInt(r['VC (100%)'])],
      ['üìâ VTR100', pct(r['VTR (100%)'])],
      ['üí∞ CPV','R$ '+fmtBR(r['CPV (R$)'])],
      ['üñ®Ô∏è Impress√µes', fmtInt(r['Impress√µes'])],
      ['üëÜ Cliques', fmtInt(r['Cliques'])],
      ['üìà CTR', pct(r['CTR (%)'])],
      ['üí∞ CPM','R$ '+fmtBR(r['CPM (R$)'])]
    );
  }
  
  if (metricsChannel) {
    metricsChannel.innerHTML = items.map(m=>`<div class='metric'><div class='label'>${m[0]}</div><div class='value'>${m[1]}</div></div>`).join('');
  } else {
    console.error('metricsChannel n√£o encontrado, n√£o √© poss√≠vel renderizar m√©tricas');
  }
  
  renderChannelDailyTable(nm);
  
  // Mostrar se√ß√µes espec√≠ficas por canal
  const showFF = (nm||'').toLowerCase()==='footfall display';
  const showCTV = (nm||'').toLowerCase()==='ctv';
  
  const footfallWrap = document.getElementById('footfallExtras');
  const ctvWrap = document.getElementById('ctvPublishers');
  
  if(footfallWrap) footfallWrap.classList.toggle('hidden', !showFF);
  if(ctvWrap) ctvWrap.classList.toggle('hidden', !showCTV);
}

sel.addEventListener('change', e=>renderChannel(e.target.value));

// Inicializar quando o DOM estiver pronto
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    if (PER && PER.length > 0 && PER[0]['Canal']) {
      renderChannel(PER[0]['Canal']);
    }
  });
} else {
  // DOM j√° est√° pronto
  if (PER && PER.length > 0 && PER[0]['Canal']) {
    renderChannel(PER[0]['Canal']);
  }
}

// ====== PLANNING POPULATION ======
(function(){
  const period = '01/12/2025 a 31/12/2025';
  const metaImp = 120000;
  const cpmContratado = 25;
  const budgetTotal = Number(CONS["Budget Contratado (R$)"]||0);
  const budgetUsed = Number(CONS["Budget Utilizado (R$)"]||0);
  const pacingBudget = budgetTotal>0 ? budgetUsed/budgetTotal : 0;
  const impEnt = Number(CONS["Impress√µes"]||0);
  const pacingImp = metaImp>0 ? impEnt/metaImp : 0;

  const setTxt = (id, txt)=>{ const el=document.getElementById(id); if(el) el.textContent = txt; };
  setTxt('plan-periodo', period);
  setTxt('plan-budget-total', fmtBR(budgetTotal));
  setTxt('plan-budget-used', fmtBR(budgetUsed));
  setTxt('plan-pacing', `${(pacingBudget*100).toFixed(2)}%`);
  setTxt('plan-imp-meta', fmtInt(metaImp));
  setTxt('plan-imp-entregues', fmtInt(impEnt));
  setTxt('plan-imp-pacing', `${(pacingImp*100).toFixed(2)}%`);
  setTxt('plan-cpm', fmtBR(cpmContratado));
})();

// ==== INSIGHTS LOGIC ====
(function(){
  // Pacing: Utilizado vs Contratado
  try {
    const ctx = document.getElementById('insPacing');
    if (ctx) {
      const contratado = Number(CONS["Budget Contratado (R$)"]||0);
      const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Pacing'],
          datasets: [
            { label: 'Contratado', data: [contratado] },
            { label: 'Utilizado', data: [utilizado] }
          ]
        },
        options: { plugins:{legend:{position:'bottom'}}, scales:{x:{stacked:true}, y:{stacked:true}} }
      });
    }
  } catch(e){}

  // Insights text
  try {
    const list = document.getElementById('insightsList');
    if (list) {
      const contratado = Number(CONS["Budget Contratado (R$)"]||0);
      const utilizado = Number(CONS["Budget Utilizado (R$)"]||0);
      const pacing = contratado>0 ? (utilizado/contratado) : 0;
      const totalImp = Number(CONS["Impress√µes"]||0);
      const totalClicks = Number(CONS["Cliques"]||0);
      const ctrTotal = totalImp>0 ? (totalClicks/totalImp)*100 : 0;
      const metaImp = 120000;
      const entregaPct = metaImp>0 ? (totalImp/metaImp)*100 : 0;

      const dailyDisplay = DAILY.filter(r => (r.channel||'').toLowerCase()==='footfall display');
      const grouped = dailyDisplay.reduce((acc,r)=>{
        const d = r.date;
        if(!acc[d]) acc[d]={impressions:0, clicks:0};
        acc[d].impressions += Number(r.impressions||0);
        acc[d].clicks += Number(r.clicks||0);
        return acc;
      },{});
      const bestCtr = Object.entries(grouped).reduce((acc,[date,val])=>{
        const ctr = val.impressions>0 ? (val.clicks/val.impressions)*100 : 0;
        return ctr > (acc.ctr||-1) ? {date, ctr} : acc;
      }, {});

      const items = [];
      items.push(`‚è±Ô∏è Pacing or√ßament√°rio: <b>${(pacing*100).toFixed(1)}%</b> do budget utilizado.`);
      items.push(`üìà Entrega de impress√µes: <b>${fmtInt(totalImp)}</b> (${entregaPct.toFixed(1)}% de 120.000 contratadas).`);
      items.push(`üéØ CTR m√©dio: <b>${ctrTotal.toFixed(2)}%</b>.`);
      if (bestCtr.date) items.push(`‚≠ê Melhor CTR di√°rio: <b>${bestCtr.ctr.toFixed(2)}%</b> em ${bestCtr.date}.`);

      list.innerHTML = items.map(t=>`<li>${t}</li>`).join("");
    }
  } catch(e){}
})();

// FOOTFALL FUNCTIONS
let footfallInitialized = false;

// Dados de footfall
const footfallData = [
  {lat: -8.092339308671471, lng: -34.888475077, name: "Recibom - Av. Eng. Domingos Ferreira, 306 - Pina", users: 1740, rate: 3},
  {lat: -8.131969149507211, lng: -34.890696877, name: "Recibom boa viagem - R. Bar√£o de Souza Le√£o, 767 - Boa Viagem, Recife - PE, 51030-300", users: 1892, rate: 7},
  {lat: -8.045915684673571, lng: -34.890921522, name: "Recibom - Torre - Rua Conde de Iraj√°, 632 - Torre, Recife - PE, 50710-310", users: 211, rate: 9},
  {lat: -8.047434924792, lng: -34.900162111, name: "Recibom - Gra√ßas - Av. Rui Barbosa, 551 - Gra√ßas, Recife - PE, 52011-040", users: 548, rate: 8},
  {lat: -8.029882473548621, lng: -34.906651677, name: "Recibom - Parnamirim - Estr. do Arraial, 2668 - Tamarineira, Recife - PE, 52051-380", users: 555, rate: 11},
  {lat: -8.119932249004491, lng: -34.890091268, name: "Recibom - Boa Viagem - R. Prof. Jo√£o Medeiros, 261 - Boa Viagem, Recife - PE, 51021-050", users: 1020, rate: 6},
  {lat: -8.142543914194251, lng: -34.908109111, name: "Recibom - Set√∫bal - R. Jo√£o Cardoso Aires, 407 - Boa Viagem, Recife - PE, 51130-300", users: 1089, rate: 15},
  {lat: -8.028130780221501, lng: -34.890250688, name: "Recibom - Encruzilhada - Av. Norte Miguel Arraes de Alencar, S/N - Encruzilhada, Recife - PE, 52041-005", users: 4328, rate: 11},
  {lat: -7.995667724325511, lng: -34.884649217, name: "Recibom - Olinda - Av. Carlos de Lima Cavalcante, 515 - Bultrins, Olinda - PE, 53030-260", users: 5121, rate: 12},
  {lat: -8.183601155218951, lng: -34.891945002, name: "Recibom - Piedade - Av. Bernardo Vieira de Melo, 3454 - Piedade, Jaboat√£o dos Guararapes - PE, 54410-010", users: 1212, rate: 11},
  {lat: -8.182334054796811, lng: -34.920023851, name: "Recibom - Piedade -Av. Ayrton Senna da Silva, 2851 - Piedade, Jaboat√£o dos Guararapes - PE, 54410-400", users: 1573, rate: 14},
  {lat: -8.018367819706791, lng: -34.996213511, name: "Recibom - Timb√≠, Camaragibe - PE, 54765-290", users: 0, rate: 0}
];

function initializeFootfall() {
  if (footfallInitialized) return;
  
  setTimeout(() => {
    initializeFootfallMetrics();
    initializeFootfallMap();
    initializeFootfallChart();
    initializeFootfallTopStores();
    footfallInitialized = true;
  }, 100);
}

function initializeFootfallMetrics() {
  const totalLojas = footfallData.length;
  const totalUsuarios = footfallData.reduce((sum, item) => sum + item.users, 0);
  const taxaMedia = footfallData.reduce((sum, item) => sum + item.rate, 0) / totalLojas;
  const melhorLoja = footfallData.reduce((max, item) => item.rate > max.rate ? item : max);

  const metricsHTML = `
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #00ff88, #06b6d4);"></div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <span style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); font-weight: 500;">Total de Lojas</span>
        <svg style="width: 20px; height: 20px; opacity: 0.6; filter: drop-shadow(0 0 5px rgba(255, 107, 53, 0.3));" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 2L3 7v11h4v-6h6v6h4V7l-7-5z"/>
        </svg>
      </div>
      <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.25rem; background: linear-gradient(45deg, #ff6b35, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${totalLojas}</div>
      <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">Regi√£o metropolitana</div>
    </div>
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #ff6b35, #ec4899);"></div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <span style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); font-weight: 500;">Total de Usu√°rios</span>
        <svg style="width: 20px; height: 20px; opacity: 0.6; filter: drop-shadow(0 0 5px rgba(255, 107, 53, 0.3));" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.25rem; background: linear-gradient(45deg, #ff6b35, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${totalUsuarios.toLocaleString()}</div>
      <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">Footfall detectado</div>
    </div>
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #8b5cf6, #00ff88);"></div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <span style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); font-weight: 500;">Taxa M√©dia</span>
        <svg style="width: 20px; height: 20px; opacity: 0.6; filter: drop-shadow(0 0 5px rgba(255, 107, 53, 0.3));" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
        </svg>
      </div>
      <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.25rem; background: linear-gradient(45deg, #ff6b35, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${taxaMedia.toFixed(1)}%</div>
      <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">Convers√£o m√©dia</div>
    </div>
    <div class="metric-card" style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; position: relative; overflow: hidden;">
      <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #ec4899, #ff6b35);"></div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
        <span style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); font-weight: 500;">Melhor Performance</span>
        <svg style="width: 20px; height: 20px; opacity: 0.6; filter: drop-shadow(0 0 5px rgba(255, 107, 53, 0.3));" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
      </div>
      <div style="font-size: 2rem; font-weight: bold; margin-bottom: 0.25rem; background: linear-gradient(45deg, #ff6b35, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${melhorLoja.rate}%</div>
      <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">${melhorLoja.name.split(' - ')[1] || 'Set√∫bal'}</div>
    </div>
  `;

  document.getElementById('footfall-metrics').innerHTML = metricsHTML;
}



function updateFootfallTopStores() {
  const topStoresContainer = document.getElementById('footfall-topStores');
  if (!topStoresContainer) {
    console.error('Elemento footfall-topStores n√£o encontrado');
    return;
  }
  
  // Limpar conte√∫do existente
  topStoresContainer.innerHTML = '';
  
  if (typeof FOOTFALL_POINTS !== 'undefined' && FOOTFALL_POINTS.length > 0) {
    // Ordenar por usu√°rios (descendente) e pegar top 5
    const sortedPoints = FOOTFALL_POINTS
      .filter(point => point.users > 0)
      .sort((a, b) => b.users - a.users)
      .slice(0, 5);
    
    sortedPoints.forEach((point, index) => {
      const storeItem = document.createElement('div');
      storeItem.className = 'store-item';
      storeItem.style.cssText = `
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 3px solid #ff6b35;
      `;
      
      storeItem.innerHTML = `
        <div>
          <div style="font-weight: 600; color: white; font-size: 0.9rem;">
            ${index + 1}. ${point.name.length > 30 ? point.name.substring(0, 30) + '...' : point.name}
          </div>
          <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.7);">
            Taxa: ${point.rate}%
          </div>
        </div>
        <div style="text-align: right;">
          <div style="font-weight: 600; color: #ff6b35; font-size: 1.1rem;">
            ${point.users.toLocaleString('pt-BR')}
          </div>
          <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.7);">
            usu√°rios
          </div>
        </div>
      `;
      
      topStoresContainer.appendChild(storeItem);
    });
    
    console.log('Top Stores footfall atualizado com', sortedPoints.length, 'lojas');
  } else {
    topStoresContainer.innerHTML = '<div style="text-align: center; color: rgba(255, 255, 255, 0.7); padding: 2rem;">Nenhum dado dispon√≠vel</div>';
  }
}



function initializeFootfallContent() {
    console.log('Inicializando conte√∫do footfall...');
    
    // Aguardar um pouco para garantir que os elementos estejam prontos
    setTimeout(() => {
        updateFootfallMetrics();
        initializeFootfallMap();
        initializeFootfallChart();
        updateFootfallTopStores();
    }, 500);
}


function updateFootfallMetrics() {
    const metricsContainer = document.getElementById('footfall-metrics');
    if (!metricsContainer || typeof FOOTFALL_POINTS === 'undefined') {
        return;
    }
    
    const footfallData = FOOTFALL_POINTS.filter(point => point.users > 0);
    
    if (footfallData.length === 0) {
        metricsContainer.innerHTML = '<div style="text-align: center; color: rgba(255, 255, 255, 0.7); padding: 2rem;">Carregando m√©tricas...</div>';
        return;
    }
    
    // Calcular m√©tricas
    const totalLojas = footfallData.length;
    const totalUsuarios = footfallData.reduce((sum, item) => sum + item.users, 0);
    const taxaMedia = footfallData.reduce((sum, item) => sum + item.rate, 0) / totalLojas;
    const melhorLoja = footfallData.reduce((max, item) => item.rate > max.rate ? item : max);
    
    const metricsHTML = `
        <div class="metric-card" style="background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; backdrop-filter: blur(10px);">
            <div class="metric-header" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span class="metric-title" style="font-weight: 600; color: #ff6b35;">üè™ Total de Lojas</span>
            </div>
            <div class="metric-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${totalLojas}</div>
            <div class="metric-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Regi√£o metropolitana</div>
        </div>
        <div class="metric-card" style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; backdrop-filter: blur(10px);">
            <div class="metric-header" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span class="metric-title" style="font-weight: 600; color: #8b5cf6;">üë• Total de Usu√°rios</span>
            </div>
            <div class="metric-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${totalUsuarios.toLocaleString('pt-BR')}</div>
            <div class="metric-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Footfall detectado</div>
        </div>
        <div class="metric-card" style="background: rgba(236, 72, 153, 0.1); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; backdrop-filter: blur(10px);">
            <div class="metric-header" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span class="metric-title" style="font-weight: 600; color: #ec4899;">üìà Taxa M√©dia</span>
            </div>
            <div class="metric-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${taxaMedia.toFixed(1)}%</div>
            <div class="metric-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Convers√£o m√©dia</div>
        </div>
        <div class="metric-card" style="background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px; padding: 1.5rem; text-align: center; backdrop-filter: blur(10px);">
            <div class="metric-header" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                <span class="metric-title" style="font-weight: 600; color: #06b6d4;">üèÜ Melhor Performance</span>
            </div>
            <div class="metric-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${melhorLoja.rate}%</div>
            <div class="metric-subtitle" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">${melhorLoja.name.split(' - ')[1] || melhorLoja.name.split(' ')[1] || 'Melhor loja'}</div>
        </div>
    `;
    
    metricsContainer.innerHTML = metricsHTML;
    console.log('M√©tricas footfall atualizadas:', { totalLojas, totalUsuarios, taxaMedia: taxaMedia.toFixed(1) + '%', melhorLoja: melhorLoja.name });
}


function initializeFootfallMap() {
    const mapElement = document.getElementById('footfall-map');
    if (!mapElement) {
        console.error('Elemento footfall-map n√£o encontrado');
        return;
    }
    
    // Destruir mapa existente se houver
    if (window.footfallMap) {
        window.footfallMap.remove();
    }
    
    const map = L.map('footfall-map').setView([-19.9078, -43.9593], 13);
    window.footfallMap = map;
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    if (typeof FOOTFALL_POINTS !== 'undefined' && FOOTFALL_POINTS.length > 0) {
        const footfallData = FOOTFALL_POINTS.filter(point => point.users > 0);
        
        // Criar cluster de markers
        const markers = L.markerClusterGroup({
            chunkedLoading: true,
            maxClusterRadius: 50,
            iconCreateFunction: function(cluster) {
                const childCount = cluster.getChildCount();
                let c = ' marker-cluster-';
                if (childCount < 10) {
                    c += 'small';
                } else if (childCount < 100) {
                    c += 'medium';
                } else {
                    c += 'large';
                }
                return new L.DivIcon({
                    html: '<div><span>' + childCount + '</span></div>',
                    className: 'marker-cluster' + c,
                    iconSize: new L.Point(40, 40)
                });
            }
        });
        
        // Adicionar markers
        footfallData.forEach(point => {
            const marker = L.marker([point.lat, point.lon]);
            marker.bindPopup(`
                <div style="font-family: 'Inter', sans-serif; min-width: 200px;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #ff6b35; font-size: 1.1rem;">${point.name}</h4>
                    <p style="margin: 0.25rem 0; font-size: 0.9rem;"><strong>Usu√°rios:</strong> ${point.users.toLocaleString('pt-BR')}</p>
                    <p style="margin: 0.25rem 0; font-size: 0.9rem;"><strong>Taxa:</strong> ${point.rate}%</p>
                </div>
            `);
            markers.addLayer(marker);
        });
        
        // Dados para heatmap
        const heatmapData = [];
        footfallData.forEach(store => {
            // Intensidade baseada na taxa de convers√£o
            const baseIntensity = Math.max(0.1, store.rate / 20); // Normalizar para 0-1
            
            // Adicionar pontos espalhados para simular densidade
            const spreadRadius = 0.005; // Raio de espalhamento
            const numPoints = Math.max(3, Math.floor(store.users / 1000)); // Mais pontos para mais usu√°rios
            
            for (let i = 0; i < numPoints; i++) {
                const offsetLat = (Math.random() - 0.5) * spreadRadius;
                const offsetLng = (Math.random() - 0.5) * spreadRadius;
                const pointIntensity = baseIntensity * (0.7 + Math.random() * 0.6);
                
                heatmapData.push([
                    store.lat + offsetLat, 
                    store.lon + offsetLng, 
                    pointIntensity
                ]);
            }
            
            // Ponto central com intensidade m√°xima
            heatmapData.push([store.lat, store.lon, baseIntensity * 1.5]);
        });
        
        // Adicionar layers ao mapa
        map.addLayer(markers);
        
        // Heatmap layer
        const heatmapLayer = L.heatLayer(heatmapData, {
            radius: 50,
            blur: 20,
            maxZoom: 18,
            minOpacity: 0.3,
            gradient: {
                0.0: 'rgba(0, 255, 136, 0.1)',
                0.2: 'rgba(6, 182, 212, 0.4)',
                0.4: 'rgba(139, 92, 246, 0.6)',
                0.6: 'rgba(236, 72, 153, 0.8)',
                0.8: 'rgba(255, 107, 53, 0.9)',
                1.0: 'rgba(255, 107, 53, 1.0)'
            }
        }).addTo(map);
        
        // Controle de layers
        const overlayMaps = {
            "üî• Mapa de Calor": heatmapLayer,
            "üìç Marcadores": markers
        };
        
        L.control.layers(null, overlayMaps, {
            position: 'topright',
            collapsed: false
        }).addTo(map);
        
        console.log(`Mapa footfall inicializado: ${footfallData.length} lojas, ${heatmapData.length} pontos de calor`);
    }
    
    // Invalidar tamanho do mapa
    setTimeout(() => {
        map.invalidateSize();
    }, 100);
    
    return map;
}

function initializeFootfallChart() {
  const ctx = document.getElementById('footfall-performanceChart').getContext('2d');
  
  const chartData = footfallData
    .filter(store => store.users > 0)
    .sort((a, b) => b.users - a.users)
    .slice(0, 8);

  new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [{
        label: 'Lojas',
        data: chartData.map(store => ({
          x: store.users,
          y: store.rate,
          label: store.name.split(' - ')[1] || store.name
        })),
        backgroundColor: 'rgba(255, 107, 53, 0.6)',
        borderColor: '#ff6b35',
        pointRadius: function(context) {
          return Math.max(5, Math.min(15, context.parsed.x / 500));
        }
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: '#ff6b35',
          bodyColor: '#ffffff',
          callbacks: {
            label: function(context) {
              return `${context.raw.label}: ${context.parsed.x.toLocaleString()} usu√°rios, ${context.parsed.y}%`;
            }
          }
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Usu√°rios Footfall',
            color: '#ffffff'
          },
          ticks: {
            color: '#ffffff'
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          }
        },
        y: {
          title: {
            display: true,
            text: 'Taxa de Convers√£o (%)',
            color: '#ffffff'
          },
          ticks: {
            color: '#ffffff'
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          }
        }
      }
    }
  });
}

function initializeFootfallTopStores() {
  const topStores = footfallData
    .filter(store => store.users > 0)
    .sort((a, b) => b.users - a.users)
    .slice(0, 5);

  const topStoresHTML = topStores.map(store => `
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s;">
      <div style="font-weight: 500; flex: 1; color: #ffffff;">${store.name.split(' - ')[1] || store.name}</div>
      <div style="display: flex; gap: 2rem; font-size: 0.9rem;">
        <div style="color: #06b6d4; font-weight: 500;">${store.users.toLocaleString()} usu√°rios</div>
        <div style="color: #ff6b35; font-weight: 500;">${store.rate}%</div>
      </div>
    </div>
  `).join('');

  document.getElementById('footfall-topStores').innerHTML = topStoresHTML;
}

</script>
</body>
</html>
