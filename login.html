<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Login - Painel de Controle</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<style>
  :root{
    --bg:#0f0f23;
    --bg2:#1a1a2e;
    --panel:#16213e;
    --stroke:rgba(148,163,184,.25);
    --muted:rgba(148,163,184,.8);
    --grad:linear-gradient(135deg,#ff6b35,#8b5cf6);
    --accent:#00ff88;
    --danger:#ff4757;
    --warning:#ffa726;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#fff;
       background:linear-gradient(135deg,var(--bg) 0%,var(--bg2) 50%,var(--panel) 100%);
       min-height:100vh;display:flex;align-items:center;justify-content:center;}
  
  .login-container{background:rgba(26,26,46,.9);border:1px solid var(--stroke);border-radius:20px;padding:40px;width:100%;max-width:400px;backdrop-filter:blur(10px);box-shadow:0 20px 40px rgba(0,0,0,.3)}
  
  .login-header{text-align:center;margin-bottom:32px}
  .logo{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:16px}
  .logo-icon{width:48px;height:48px;border-radius:12px;background:var(--grad);display:grid;place-items:center;font-weight:700;font-size:1.2rem}
  .login-title{font-size:1.8rem;font-weight:700;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
  .login-subtitle{color:var(--muted);font-size:.9rem}
  
  .form-group{margin-bottom:20px}
  .form-label{display:block;margin-bottom:8px;color:var(--muted);font-size:.85rem;text-transform:uppercase;letter-spacing:.1em}
  .form-input{width:100%;padding:12px 16px;background:rgba(255,255,255,.05);border:1px solid var(--stroke);border-radius:10px;color:#fff;font-size:1rem;transition:all .3s ease}
  .form-input:focus{outline:none;border-color:rgba(255,107,53,.5);background:rgba(255,255,255,.08);box-shadow:0 0 0 3px rgba(255,107,53,.1)}
  .form-input::placeholder{color:rgba(148,163,184,.5)}
  
  .login-button{width:100%;padding:14px;background:var(--grad);border:none;border-radius:10px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:8px}
  .login-button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(139,92,246,.4)}
  .login-button:disabled{opacity:0.6;cursor:not-allowed;transform:none}
  .login-button.loading{animation:pulse 1.5s infinite}
  
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
  
  .error-message{background:rgba(255,71,87,.1);border:1px solid rgba(255,71,87,.3);border-radius:8px;padding:12px;margin-bottom:20px;color:var(--danger);font-size:.9rem;display:none}
  .success-message{background:rgba(0,255,136,.1);border:1px solid rgba(0,255,136,.3);border-radius:8px;padding:12px;margin-bottom:20px;color:var(--accent);font-size:.9rem;display:none}
  
  .login-footer{text-align:center;margin-top:24px;color:var(--muted);font-size:.8rem}
  .login-footer a{color:var(--accent);text-decoration:none}
  .login-footer a:hover{text-decoration:underline}
  
  .demo-credentials{background:rgba(255,107,53,.05);border:1px solid rgba(255,107,53,.2);border-radius:8px;padding:16px;margin-bottom:20px;font-size:.8rem;color:var(--muted)}
  .demo-credentials h4{color:#fff;margin-bottom:8px;font-size:.9rem}
  .demo-credentials p{margin:4px 0}
  .demo-credentials strong{color:var(--accent)}
  
  @media (max-width:480px){
    .login-container{padding:24px;margin:16px}
  }
</style>
</head>
<body>
<div class="login-container">
  <div class="login-header">
    <div class="logo">
      <div class="logo-icon">üîê</div>
    </div>
    <h1 class="login-title">Acesso Restrito</h1>
    <p class="login-subtitle">Painel de Controle de Dashboards</p>
  </div>

  <div class="demo-credentials">
    <h4>üîë Credenciais de Demonstra√ß√£o</h4>
    <p><strong>Usu√°rio:</strong> admin</p>
    <p><strong>Senha:</strong> dashboard2025</p>
  </div>

  <div id="errorMessage" class="error-message"></div>
  <div id="successMessage" class="success-message"></div>

  <form id="loginForm">
    <div class="form-group">
      <label for="username" class="form-label">Usu√°rio</label>
      <input type="text" id="username" name="username" class="form-input" placeholder="Digite seu usu√°rio" required>
    </div>
    
    <div class="form-group">
      <label for="password" class="form-label">Senha</label>
      <input type="password" id="password" name="password" class="form-input" placeholder="Digite sua senha" required>
    </div>
    
    <button type="submit" class="login-button" id="loginButton">
      <span id="buttonText">Entrar</span>
    </button>
  </form>

  <div class="login-footer">
    <p>Sistema de autentica√ß√£o seguro</p>
    <p><a href="/">‚Üê Voltar ao painel p√∫blico</a></p>
  </div>
</div>

  <!-- Incluir sistema de autentica√ß√£o -->
  <script src="auth_system.js"></script>
  <script src="auth_middleware.js"></script>
  
  <script>
// Verificar se j√° est√° logado usando sistema robusto
if (window.authSystem && window.authSystem.isAuthenticated()) {
  const redirect = new URLSearchParams(window.location.search).get('redirect') || '/dashboard-protected.html';
  window.location.href = decodeURIComponent(redirect);
}

// Elementos do DOM
const loginForm = document.getElementById('loginForm');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const loginButton = document.getElementById('loginButton');
const buttonText = document.getElementById('buttonText');
const errorMessage = document.getElementById('errorMessage');
const successMessage = document.getElementById('successMessage');

// Fun√ß√£o para mostrar mensagem de erro
function showError(message) {
  errorMessage.textContent = message;
  errorMessage.style.display = 'block';
  successMessage.style.display = 'none';
}

// Fun√ß√£o para mostrar mensagem de sucesso
function showSuccess(message) {
  successMessage.textContent = message;
  successMessage.style.display = 'block';
  errorMessage.style.display = 'none';
}

// Fun√ß√£o para esconder mensagens
function hideMessages() {
  errorMessage.style.display = 'none';
  successMessage.style.display = 'none';
}

// Fun√ß√£o para definir estado de loading
function setLoading(loading) {
  if (loading) {
    loginButton.disabled = true;
    loginButton.classList.add('loading');
    buttonText.textContent = 'Entrando...';
  } else {
    loginButton.disabled = false;
    loginButton.classList.remove('loading');
    buttonText.textContent = 'Entrar';
  }
}

// Fun√ß√£o para salvar sess√£o
function saveSession(username, role) {
  const session = {
    username: username,
    role: role,
    loginTime: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 horas
  };
  
  localStorage.setItem('dashboard_session', JSON.stringify(session));
}

// Fun√ß√£o para verificar se j√° est√° logado
function checkExistingSession() {
  const session = localStorage.getItem('dashboard_session');
  if (session) {
    try {
      const sessionData = JSON.parse(session);
      const now = new Date();
      const expiresAt = new Date(sessionData.expiresAt);
      
      if (now < expiresAt) {
        // Sess√£o ainda v√°lida, redirecionar
        window.location.href = '/dashboard-protected.html';
        return true;
      } else {
        // Sess√£o expirada, remover
        localStorage.removeItem('dashboard_session');
      }
    } catch (e) {
      // Sess√£o inv√°lida, remover
      localStorage.removeItem('dashboard_session');
    }
  }
  return false;
}

// Fun√ß√£o para processar login usando sistema robusto
async function processLogin(username, password) {
  setLoading(true);
  hideMessages();
  
  try {
    // Simular delay de autentica√ß√£o
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Usar sistema de autentica√ß√£o robusto
    if (window.authSystem) {
      const result = await window.authSystem.authenticate(username, password);
      
      if (result.success) {
        showSuccess(`Bem-vindo, ${result.user.profile.full_name}!`);
        
        // Redirecionar ap√≥s delay
        setTimeout(() => {
          const redirect = new URLSearchParams(window.location.search).get('redirect') || '/dashboard-protected.html';
          window.location.href = decodeURIComponent(redirect);
        }, 1500);
        
      } else {
        showError(result.message || 'Usu√°rio ou senha inv√°lidos');
      }
    } else {
      showError('Sistema de autentica√ß√£o n√£o dispon√≠vel');
    }
    
  } catch (error) {
    console.error('Erro no login:', error);
    showError('Erro interno. Tente novamente.');
  } finally {
    setLoading(false);
  }
}

// Event listener para o formul√°rio
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const username = usernameInput.value.trim();
  const password = passwordInput.value;
  
  if (!username || !password) {
    showError('Por favor, preencha todos os campos.');
    return;
  }
  
  await processLogin(username, password);
});

// Verificar se j√° est√° logado ao carregar a p√°gina
document.addEventListener('DOMContentLoaded', () => {
  if (checkExistingSession()) {
    return; // J√° redirecionado
  }
  
  // Focar no campo de usu√°rio
  usernameInput.focus();
});

// Adicionar efeitos visuais
usernameInput.addEventListener('focus', hideMessages);
passwordInput.addEventListener('focus', hideMessages);

// Enter no campo de senha
passwordInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    loginForm.dispatchEvent(new Event('submit'));
  }
});
</script>
</body>
</html>
