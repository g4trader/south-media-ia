<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Sheet ID Issue</title>
</head>
<body>
    <h1>Debug - Sheet ID Issue</h1>
    <div id="debug-output"></div>

    <script>
        // Fun√ß√£o extractSheetId do frontend
        function extractSheetId(url) {
            console.log("üîç extractSheetId chamada com:", url);
            
            if (!url) {
                console.log("‚ùå URL vazia");
                return '';
            }
            
            // Se j√° √© um ID (sem caracteres especiais), retorna como est√°
            if (!url.includes('/') && !url.includes('?')) {
                console.log("‚úÖ J√° √© um ID:", url);
                return url;
            }
            
            // Extrair ID de URLs do Google Sheets
            const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
            const result = match ? match[1] : url;
            console.log("‚úÖ ID extra√≠do:", result);
            return result;
        }

        // Teste com a URL fornecida pelo usu√°rio
        const userUrl = "https://docs.google.com/spreadsheets/d/1IUUSXaN0Drrdt-7B0IUiMRQK2gT-JtzhCFZvV7e5-V8/edit?gid=668487440#gid=668487440";
        
        console.log("üß™ Testando extra√ß√£o de ID da planilha:");
        console.log("URL fornecida:", userUrl);
        
        const extractedId = extractSheetId(userUrl);
        
        console.log("ID extra√≠do:", extractedId);
        console.log("ID esperado:", "1IUUSXaN0Drrdt-7B0IUiMRQK2gT-JtzhCFZvV7e5-V8");
        console.log("‚úÖ Teste passou:", extractedId === "1IUUSXaN0Drrdt-7B0IUiMRQK2gT-JtzhCFZvV7e5-V8");

        // Simular o processo de coleta de dados do formul√°rio
        function simulateFormCollection() {
            console.log("üß™ Simulando coleta de dados do formul√°rio...");
            
            // Simular dados do formul√°rio
            const mockFormData = {
                campaignName: "TESTE DEBUG",
                startDate: "2025-09-15",
                endDate: "2025-09-30",
                totalBudget: 10000,
                reportModel: "Simples",
                kpiType: "CPV",
                kpiValue: 0.16,
                kpiTarget: 1000,
                strategies: "Teste de estrat√©gias",
                channels: []
            };

            // Simular canal selecionado
            const channelName = "programmatic_video";
            const sheetIdRaw = userUrl; // URL completa fornecida pelo usu√°rio
            const sheetId = extractSheetId(sheetIdRaw);
            const gid = "668487440";
            const budget = 10000;
            const quantity = 1000;

            console.log("üìä Dados do canal:");
            console.log("  - channelName:", channelName);
            console.log("  - sheetIdRaw:", sheetIdRaw);
            console.log("  - sheetId:", sheetId);
            console.log("  - gid:", gid);
            console.log("  - budget:", budget);
            console.log("  - quantity:", quantity);

            // Verificar se sheetId est√° vazio
            if (!sheetId || sheetId.trim() === '') {
                console.error("‚ùå Sheet ID vazio!");
                return false;
            }

            mockFormData.channels.push({
                name: channelName,
                displayName: "üé¨ Program√°tica Video",
                sheetId: sheetId,
                gid: gid || null,
                budget: budget,
                quantity: quantity
            });

            console.log("‚úÖ Dados coletados com sucesso:", mockFormData);
            return true;
        }

        // Executar teste
        const result = simulateFormCollection();
        
        // Mostrar resultado na p√°gina
        const output = document.getElementById('debug-output');
        output.innerHTML = `
            <h2>Resultado do Debug:</h2>
            <p><strong>URL fornecida:</strong> ${userUrl}</p>
            <p><strong>ID extra√≠do:</strong> ${extractedId}</p>
            <p><strong>Teste passou:</strong> ${extractedId === "1IUUSXaN0Drrdt-7B0IUiMRQK2gT-JtzhCFZvV7e5-V8" ? "‚úÖ Sim" : "‚ùå N√£o"}</p>
            <p><strong>Coleta de dados:</strong> ${result ? "‚úÖ Sucesso" : "‚ùå Falhou"}</p>
        `;
    </script>
</body>
</html>
